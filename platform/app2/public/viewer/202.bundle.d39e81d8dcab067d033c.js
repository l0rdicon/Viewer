/*! For license information please see 202.bundle.d39e81d8dcab067d033c.js.LICENSE.txt */
(self.webpackChunk=self.webpackChunk||[]).push([[202],{91202:(e,t,n)=>{"use strict";n.d(t,{Yb:()=>Pe,adaptersSR:()=>En,ok:()=>Rn});var r=n(67540),a=n(87513),i=n.n(a),o=n(11677),u=n.n(o),s=n(58955),c=n(45451);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(){d=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",o=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function c(e,t,n,a){var i=t&&t.prototype instanceof h?t:h,o=Object.create(i.prototype),u=new O(a||[]);return r(o,"_invoke",{value:w(e,n,u)}),o}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var l={};function h(){}function p(){}function g(){}var m={};s(m,i,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(x([])));v&&v!==t&&n.call(v,i)&&(m=v);var S=g.prototype=h.prototype=Object.create(m);function I(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function a(r,i,o,u){var s=f(e[r],e,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==typeof l&&n.call(l,"__await")?t.resolve(l.__await).then((function(e){a("next",e,o,u)}),(function(e){a("throw",e,o,u)})):t.resolve(l).then((function(e){c.value=e,o(c)}),(function(e){return a("throw",e,o,u)}))}u(s.arg)}var i;r(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,r){a(e,n,t,r)}))}return i=i?i.then(r,r):r()}})}function w(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return E()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var u=b(o,n);if(u){if(u===l)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var s=f(e,t,n);if("normal"===s.type){if(r=n.done?"completed":"suspendedYield",s.arg===l)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r="completed",n.method="throw",n.arg=s.arg)}}}function b(e,t){var n=t.method,r=e.iterator[n];if(void 0===r)return t.delegate=null,"throw"===n&&e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),l;var a=f(r,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,l;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function D(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function x(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:E}}function E(){return{value:void 0,done:!0}}return p.prototype=g,r(S,"constructor",{value:g,configurable:!0}),r(g,"constructor",{value:p,configurable:!0}),p.displayName=s(g,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,s(e,u,"GeneratorFunction")),e.prototype=Object.create(S),e},e.awrap=function(e){return{__await:e}},I(T.prototype),s(T.prototype,o,(function(){return this})),e.AsyncIterator=T,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new T(c(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},I(S),s(S,u,"Generator"),s(S,i,(function(){return this})),s(S,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},e.values=x,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(D),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),D(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;D(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:x(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}function h(e,t,n,r,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void n(e)}u.done?t(s):Promise.resolve(s).then(r,a)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,b(r.key),r)}}function m(e,t,n){return t&&g(e.prototype,t),n&&g(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function y(e,t,n){return(t=b(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i,o,u=[],s=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=i.call(n)).done)&&(u.push(r.value),u.length!==t);s=!0);}catch(e){c=!0,a=e}finally{try{if(!s&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(c)throw a}}return u}}(e,t)||I(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e){return function(e){if(Array.isArray(e))return T(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||I(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function w(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=I(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw i}}}}function b(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var C=function(e){return Array.isArray(e)?e:[e]},D=function(e){return function(t){return t.ConceptNameCodeSequence.CodeMeaning===e}},O=r.hC.TID1500,x=r.hC.addAccessors,E=r.U7.StructuredReport,R=r.oq.Normalizer,A=O.TID1500MeasurementReport,M=O.TID1501MeasurementGroup,P=r.aT.DicomMetaDictionary,N={CodingSchemeDesignator:"DCM",CodeValue:"121071"},U={CodingSchemeDesignator:"SCT",CodeValue:"363698007"},B={CodingSchemeDesignator:"SRT",CodeValue:"G-C0E3"},_=function(e,t,n){var r=e.ConceptNameCodeSequence;if(r){var a=r.CodingSchemeDesignator,i=r.CodeValue;return a==t.CodingSchemeDesignator&&i==t.CodeValue||n&&a==n.CodingSchemeDesignator&&i==n.CodeValue}};var k=function(){function e(){p(this,e)}return m(e,null,[{key:"getSetupMeasurementData",value:function(e){var t=e.ContentSequence,n=C(t),r=n.find((function(e){return _(e,N)})),a=n.filter((function(e){return _(e,U,B)}))||[],i=n.find((function(e){return"NUM"===e.ValueType})),o=C(i.ContentSequence).find((function(e){return"SCOORD"===e.ValueType})),u=o.ContentSequence.ReferencedSOPSequence,s=u.ReferencedSOPInstanceUID,c=u.ReferencedFrameNumber,f={sopInstanceUid:s,frameIndex:c||1,complete:!0,finding:r?x(r.ConceptCodeSequence):void 0,findingSites:a.map((function(e){return x(e.ConceptCodeSequence)}))};f.finding&&(f.description=f.finding.CodeMeaning);var l=f.findingSites&&f.findingSites[0];return l&&(f.location=l[0]&&l[0].CodeMeaning||l.CodeMeaning),{defaultState:f,findingGroup:r,findingSiteGroups:a,NUMGroup:i,SCOORDGroup:o,ReferencedSOPSequence:u,ReferencedSOPInstanceUID:s,ReferencedFrameNumber:c}}},{key:"generateReport",value:function(e,t,n){var r=[],a=Object.keys(e)[0];if(!a)throw new Error("No measurements provided.");var i=t.get("generalSeriesModule",a),o=i.studyInstanceUID,u=i.seriesInstanceUID;Object.keys(e).forEach((function(n){var a=t.get("sopCommonModule",n),i=t.get("frameNumber",n),o=e[n],u=Object.keys(o),s={ReferencedSOPClassUID:a.sopClassUID,ReferencedSOPInstanceUID:a.sopInstanceUID};R.isMultiframeSOPClassUID(a.sopClassUID)&&(s.ReferencedFrameNumber=i);var c=[];u.forEach((function(e){var t=function(e,t,n){var r=t[e],a=k.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE[e];if(r&&r.data&&r.data.length&&a){var i=r.data.map((function(e){return function(e,t,n,r){var a=r.getTID300RepresentationArguments(e);return a.ReferencedSOPSequence=n,new r.TID300Representation(a)}(e,0,n,a)}));return new M(i)}}(e,o,s);t&&c.push(t)})),r=r.concat(c)}));var s=new A({TID1501MeasurementGroups:r},n),c=new Uint8Array(2);c[1]=1;var f={StudyInstanceUID:o,SeriesInstanceUID:u},l={FileMetaInformationVersion:{Value:[c.buffer],vr:"OB"},TransferSyntaxUID:{Value:["1.2.840.10008.1.2.1"],vr:"UI"},ImplementationClassUID:{Value:[P.uid()],vr:"UI"},ImplementationVersionName:{Value:["dcmjs"],vr:"SH"}};f._meta=l,f._vrMap={PixelData:"OW"};var d=new E([f]),h=s.contentItem(f);return d.dataset=Object.assign(d.dataset,h),d.dataset._meta=l,d}},{key:"generateToolState",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("1500"!==t.ContentTemplateSequence.TemplateIdentifier)throw new Error("This package can currently only interpret DICOM SR TID 1500");var r=C(t.ContentSequence).find(D("Imaging Measurements")),a=C(r.ContentSequence).filter(D("Measurement Group")),i={},o=e.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE,u=[];return Object.keys(o).forEach((function(e){u.push(o[e]),i[e]=[]})),a.forEach((function(e){var r=C(e.ContentSequence).find((function(e){return"Tracking Identifier"===e.ConceptNameCodeSequence.CodeMeaning})).TextValue,a=n.getToolClass?n.getToolClass(e,t,u):u.find((function(e){return e.isValidCornerstoneTrackingIdentifier(r)}));if(a){var o=a.getMeasurementData(e);console.log("=== ".concat(a.toolType," ===")),console.log(o),i[a.toolType].push(o)}})),i}},{key:"registerTool",value:function(t){e.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE[t.utilityToolType]=t,e.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE[t.toolType]=t,e.MEASUREMENT_BY_TOOLTYPE[t.toolType]=t.utilityToolType}}]),e}();k.MEASUREMENT_BY_TOOLTYPE={},k.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE={},k.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE={};var q="cornerstoneTools@^4.0.0",L=r.hC.TID300.Length,V="Length",G=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(t){var n=k.getSetupMeasurementData(t),r=n.defaultState,a=n.NUMGroup,i=n.SCOORDGroup,o=l(l({},r),{},{length:a.MeasuredValueSequence.NumericValue,toolType:e.toolType,handles:{start:{},end:{},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}),u=v(i.GraphicData,4);return o.handles.start.x=u[0],o.handles.start.y=u[1],o.handles.end.x=u[2],o.handles.end.y=u[3],o}},{key:"getTID300RepresentationArguments",value:function(e){var t=e.handles,n=e.finding,r=e.findingSites;return{point1:t.start,point2:t.end,distance:e.length,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:Length",finding:n,findingSites:r||[]}}}]),e}();G.toolType=V,G.utilityToolType=V,G.TID300Representation=L,G.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=v(e.split(":"),2),n=t[0],r=t[1];return n===q&&r===V},k.registerTool(G);var j=r.hC.TID300.Polyline,F=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(t){for(var n=k.getSetupMeasurementData(t),r=n.defaultState,a=n.SCOORDGroup,i=n.NUMGroup,o=l(l({},r),{},{toolType:e.toolType,handles:{points:[],textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}},cachedStats:{area:i?i.MeasuredValueSequence.NumericValue:0},color:void 0,invalidated:!0}),u=a.GraphicData,s=0;s<u.length;s+=2)o.handles.points.push({x:u[s],y:u[s+1]});return o}},{key:"getTID300RepresentationArguments",value:function(e){var t=e.handles,n=e.finding,r=e.findingSites,a=e.cachedStats,i=void 0===a?{}:a,o=t.points,u=i.area,s=void 0===u?0:u,c=i.perimeter;return{points:o,area:s,perimeter:void 0===c?0:c,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:FreehandRoi",finding:n,findingSites:r||[]}}}]),e}();F.toolType="FreehandRoi",F.utilityToolType="FreehandRoi",F.TID300Representation=j,F.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=v(e.split(":"),2),n=t[0],r=t[1];return n===q&&r===F.toolType},k.registerTool(F);var Y=r.hC.TID300.Bidirectional,z="Bidirectional",H=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(t){var n=t.ContentSequence,r=C(n).find((function(e){return"121071"===e.ConceptNameCodeSequence.CodeValue})),a=C(n).filter((function(e){return"G-C0E3"===e.ConceptNameCodeSequence.CodeValue})),i=C(n).find((function(e){return"Long Axis"===e.ConceptNameCodeSequence.CodeMeaning})),o=C(i.ContentSequence).find((function(e){return"SCOORD"===e.ValueType})),u=C(n).find((function(e){return"Short Axis"===e.ConceptNameCodeSequence.CodeMeaning})),s=C(u.ContentSequence).find((function(e){return"SCOORD"===e.ValueType})),c=o.ContentSequence.ReferencedSOPSequence,f=c.ReferencedSOPInstanceUID,l=c.ReferencedFrameNumber,d=String(i.MeasuredValueSequence.NumericValue),h=String(u.MeasuredValueSequence.NumericValue),p=Math.max(o.GraphicData[0],o.GraphicData[2],s.GraphicData[0],s.GraphicData[2]),g=Math.max(o.GraphicData[1],o.GraphicData[3],s.GraphicData[1],s.GraphicData[3]);return{sopInstanceUid:f,frameIndex:l||1,toolType:e.toolType,active:!1,handles:{start:{x:o.GraphicData[0],y:o.GraphicData[1],drawnIndependently:!1,allowedOutsideImage:!1,active:!1,highlight:!1,index:0},end:{x:o.GraphicData[2],y:o.GraphicData[3],drawnIndependently:!1,allowedOutsideImage:!1,active:!1,highlight:!1,index:1},perpendicularStart:{x:s.GraphicData[0],y:s.GraphicData[1],drawnIndependently:!1,allowedOutsideImage:!1,active:!1,highlight:!1,index:2},perpendicularEnd:{x:s.GraphicData[2],y:s.GraphicData[3],drawnIndependently:!1,allowedOutsideImage:!1,active:!1,highlight:!1,index:3},textBox:{highlight:!1,hasMoved:!0,active:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0,x:p+10,y:g+10}},invalidated:!1,isCreating:!1,longestDiameter:d,shortestDiameter:h,toolName:"Bidirectional",visible:!0,finding:r?r.ConceptCodeSequence:void 0,findingSites:a.map((function(e){return e.ConceptCodeSequence}))}}},{key:"getTID300RepresentationArguments",value:function(e){var t=e.handles,n=t.start,r=t.end,a=t.perpendicularStart,i=t.perpendicularEnd,o=e.shortestDiameter;return{longAxis:{point1:n,point2:r},shortAxis:{point1:a,point2:i},longAxisLength:e.longestDiameter,shortAxisLength:o,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:Bidirectional",finding:e.finding,findingSites:e.findingSites||[]}}}]),e}();H.toolType=z,H.utilityToolType=z,H.TID300Representation=Y,H.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=v(e.split(":"),2),n=t[0],r=t[1];return n===q&&r===z},k.registerTool(H);var W=r.hC.TID300.Ellipse,X="EllipticalRoi",J=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(t){var n=k.getSetupMeasurementData(t),r=n.defaultState,a=n.NUMGroup,i=n.SCOORDGroup.GraphicData,o=[{x:i[0],y:i[1]},{x:i[2],y:i[3]}],u=[{x:i[4],y:i[5]},{x:i[6],y:i[7]}],s=Math.sqrt(Math.pow(u[0].x-u[1].x,2)+Math.pow(u[0].y-u[1].y,2)),c=(u[1].x-u[0].x)/s,f=(u[1].y-u[0].y)/s,d=s/2,h={x:o[0].x+c*d,y:o[0].y+f*d},p={x:o[1].x-c*d,y:o[1].y-f*d};return l(l({},r),{},{toolType:e.toolType,active:!1,cachedStats:{area:a?a.MeasuredValueSequence.NumericValue:0},handles:{end:{x:h.x,y:h.y,highlight:!1,active:!1},initialRotation:0,start:{x:p.x,y:p.y,highlight:!1,active:!1},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}},invalidated:!0,visible:!0})}},{key:"getTID300RepresentationArguments",value:function(e){var t=e.cachedStats,n=void 0===t?{}:t,r=e.handles,a=e.finding,i=e.findingSites,o=r.start,u=r.end,s=n.area,c=Math.abs(o.x-u.x)/2,f=Math.abs(o.y-u.y)/2,l=[],d={x:(o.x+u.x)/2,y:(o.y+u.y)/2};c>f?(l.push({x:d.x-c,y:d.y}),l.push({x:d.x+c,y:d.y}),l.push({x:d.x,y:d.y-f}),l.push({x:d.x,y:d.y+f})):(l.push({x:d.x,y:d.y-f}),l.push({x:d.x,y:d.y+f}),l.push({x:d.x-c,y:d.y}),l.push({x:d.x+c,y:d.y}));return{area:s,points:l,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:EllipticalRoi",finding:a,findingSites:i||[]}}}]),e}();J.toolType=X,J.utilityToolType=X,J.TID300Representation=W,J.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=v(e.split(":"),2),n=t[0],r=t[1];return n===q&&r===X},k.registerTool(J);var K=r.hC.TID300.Circle,Q="CircleRoi",Z=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(t){var n=k.getSetupMeasurementData(t),r=n.defaultState,a=n.NUMGroup,i=n.SCOORDGroup.GraphicData,o={x:i[0],y:i[1]},u={x:i[2],y:i[3]};return l(l({},r),{},{toolType:e.toolType,active:!1,cachedStats:{area:a?a.MeasuredValueSequence.NumericValue:0,radius:0,perimeter:0},handles:{end:l(l({},u),{},{highlight:!1,active:!1}),initialRotation:0,start:l(l({},o),{},{highlight:!1,active:!1}),textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}},invalidated:!0,visible:!0})}},{key:"getTID300RepresentationArguments",value:function(e){var t=e.cachedStats,n=void 0===t?{}:t,r=e.handles,a=e.finding,i=e.findingSites,o=r.start,u=r.end,s=n.area,c=n.radius,f=2*Math.PI*c,l=[];l.push(o),l.push(u);return{area:s,perimeter:f,radius:c,points:l,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:CircleRoi",finding:a,findingSites:i||[]}}}]),e}();Z.toolType=Q,Z.utilityToolType=Q,Z.TID300Representation=K,Z.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=v(e.split(":"),2),n=t[0],r=t[1];return n===q&&r===Q},k.registerTool(Z);var $=r.hC.TID300.Point,ee="ArrowAnnotate",te="CORNERSTONEFREETEXT",ne=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(t){var n=k.getSetupMeasurementData(t),r=n.defaultState,a=n.SCOORDGroup,i=n.findingGroup.ConceptCodeSequence.CodeMeaning,o=a.GraphicData;return l(l({},r),{},{toolType:e.toolType,active:!1,handles:{start:{x:o[0],y:o[1],highlight:!0,active:!1},end:{x:4==o.length?o[2]:o[0]+20,y:4==o.length?o[3]:o[1]+20,highlight:!0,active:!1},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}},invalidated:!0,text:i,visible:!0})}},{key:"getTID300RepresentationArguments",value:function(e){var t=[e.handles.start,e.handles.end],n=e.finding,r={points:t,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:ArrowAnnotate",findingSites:e.findingSites||[]};return n&&n.CodeValue===te||(n={CodeValue:te,CodingSchemeDesignator:"CST4",CodeMeaning:e.text}),r.finding=n,r}}]),e}();ne.toolType=ee,ne.utilityToolType=ee,ne.TID300Representation=$,ne.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=v(e.split(":"),2),n=t[0],r=t[1];return n===q&&r===ee},k.registerTool(ne);var re=r.hC.TID300.CobbAngle,ae="CobbAngle",ie=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(t){var n=k.getSetupMeasurementData(t),r=n.defaultState,a=n.NUMGroup,i=n.SCOORDGroup,o=l(l({},r),{},{rAngle:a.MeasuredValueSequence.NumericValue,toolType:e.toolType,handles:{start:{},end:{},start2:{highlight:!0,drawnIndependently:!0},end2:{highlight:!0,drawnIndependently:!0},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}),u=v(i.GraphicData,8);return o.handles.start.x=u[0],o.handles.start.y=u[1],o.handles.end.x=u[2],o.handles.end.y=u[3],o.handles.start2.x=u[4],o.handles.start2.y=u[5],o.handles.end2.x=u[6],o.handles.end2.y=u[7],o}},{key:"getTID300RepresentationArguments",value:function(e){var t=e.handles,n=e.finding,r=e.findingSites;return{point1:t.start,point2:t.end,point3:t.start2,point4:t.end2,rAngle:e.rAngle,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:CobbAngle",finding:n,findingSites:r||[]}}}]),e}();ie.toolType=ae,ie.utilityToolType=ae,ie.TID300Representation=re,ie.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=v(e.split(":"),2),n=t[0],r=t[1];return n===q&&r===ae},k.registerTool(ie);var oe=r.hC.TID300.Angle,ue="Angle",se=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(t){var n=k.getSetupMeasurementData(t),r=n.defaultState,a=n.NUMGroup,i=n.SCOORDGroup,o=l(l({},r),{},{rAngle:a.MeasuredValueSequence.NumericValue,toolType:e.toolType,handles:{start:{},middle:{},end:{},textBox:{hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}),u=v(i.GraphicData,8);return o.handles.start.x=u[0],o.handles.start.y=u[1],o.handles.middle.x=u[2],o.handles.middle.y=u[3],o.handles.middle.x=u[4],o.handles.middle.y=u[5],o.handles.end.x=u[6],o.handles.end.y=u[7],o}},{key:"getTID300RepresentationArguments",value:function(e){var t=e.handles,n=e.finding,r=e.findingSites;return{point1:t.start,point2:t.middle,point3:t.middle,point4:t.end,rAngle:e.rAngle,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:Angle",finding:n,findingSites:r||[]}}}]),e}();se.toolType=ue,se.utilityToolType=ue,se.TID300Representation=oe,se.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=v(e.split(":"),2),n=t[0],r=t[1];return n===q&&r===ue},k.registerTool(se);var ce=r.hC.TID300.Polyline,fe=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(t){var n=k.getSetupMeasurementData(t),r=n.defaultState,a=n.SCOORDGroup,i=n.NUMGroup,o=l(l({},r),{},{toolType:e.toolType,handles:{start:{},end:{},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0},initialRotation:0},cachedStats:{area:i?i.MeasuredValueSequence.NumericValue:0},color:void 0,invalidated:!0}),u=v(a.GraphicData,6);return o.handles.start.x=u[0],o.handles.start.y=u[1],u[2],u[3],o.handles.end.x=u[4],o.handles.end.y=u[5],o}},{key:"getTID300RepresentationArguments",value:function(e){var t=e.finding,n=e.findingSites,r=e.cachedStats,a=void 0===r?{}:r,i=e.handles,o=i.start,u=i.end;return{points:[o,{x:o.x,y:u.y},u,{x:u.x,y:o.y}],area:a.area,perimeter:a.perimeter,trackingIdentifierTextValue:"cornerstoneTools@^4.0.0:RectangleRoi",finding:t,findingSites:n||[]}}}]),e}();fe.toolType="RectangleRoi",fe.utilityToolType="RectangleRoi",fe.TID300Representation=ce,fe.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=v(e.split(":"),2),n=t[0],r=t[1];return n===q&&r===fe.toolType},k.registerTool(fe);var le=r.hC.orientation,de=le.rotateDirectionCosinesInPlane,he=le.flipImageOrientationPatient,pe=le.flipMatrix2D,ge=le.rotateMatrix902D,me=r.hC.datasetToBlob,ye=r.hC.BitArray,ve=r.hC.DicomMessage,Se=r.hC.DicomMetaDictionary,Ie=r.oq.Normalizer,Te=r.U7.Segmentation,we={generateSegmentation:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{includeSliceSpacing:!0},r=t.toolState,a=t.segments,i=e[0],o={x:i.columns,y:i.rows,z:e.length};if(o.xy=o.x*o.y,!Ce(s,a))throw new Error("No segments to export!");for(var u=i.imageId.includes("?frame"),s=function(e,t,n){var r=[];if(t){var a=e[0].data.byteArray.buffer,i=ve.readFile(a),o=Se.naturalizeDataset(i.dict);o._meta=Se.namifyDataset(i.meta),r.push(o)}else for(var u=0;u<e.length;u++){var s=e[u].data.byteArray.buffer,c=ve.readFile(s),f=Se.naturalizeDataset(c.dict);f._meta=Se.namifyDataset(c.meta),r.push(f)}var l=Ie.normalizeToDataset(r);return new Te([l],n)}(e,u,n),c=function(e,t,n){for(var r=[],a=[],i=0;i<n.length;i++)n[i]&&(r.push(i),a.push([]));for(var o=0;o<t.length;o++)for(var u=e[t[o].imageId],s=0;s<r.length;s++){var c=r[s];u&&u.brush&&u.brush.data&&u.brush.data[c]&&u.brush.data[c].pixelData&&a[s].push(o)}return{referencedFramesPerSegment:a,segmentIndicies:r}}(r,e,a),f=c.referencedFramesPerSegment,l=c.segmentIndicies,d=0,h=0;h<f.length;h++)d+=f[h].length;s.setNumberOfFrames(d);for(var p=0;p<l.length;p++){var g=l[p],m=f[p],y=m.map((function(e){return e+1})),v=a[g];s.addSegment(v,be(g,m,r,e,o),y)}return s.bitPackPixelData(),me(s.dataset)},generateToolState:function(e,t,n){var a=ve.readFile(t),o=Se.naturalizeDataset(a.dict);o._meta=Se.namifyDataset(a.meta);var u=Ie.normalizeToDataset([o]),s=n.get("imagePlaneModule",e[0]);s||console.warn("Insufficient metadata, imagePlaneModule missing.");for(var c=function(e){var t=[];t[0]=e,t[1]=he.h(e),t[2]=he.v(e);var n=de(e,Math.PI/2);return t[3]=n,t[4]=he.h(n),t[5]=he.v(n),t[6]=de(e,Math.PI),t[7]=de(e,1.5*Math.PI),t}(Array.isArray(s.rowCosines)?[].concat(S(s.rowCosines),S(s.columnCosines)):[s.rowCosines.x,s.rowCosines.y,s.rowCosines.z,s.columnCosines.x,s.columnCosines.y,s.columnCosines.z]),f=u.SharedFunctionalGroupsSequence,l=f.PlaneOrientationSequence?f.PlaneOrientationSequence.ImageOrientationPatient:void 0,d=u.Columns*u.Rows,h=function(e){var t=[],n=e.SegmentSequence;if(Array.isArray(n))for(var r=0;r<n.length;r++)t.push(n[r]);else t.push(n);return{seriesInstanceUid:e.ReferencedSeriesSequence.SeriesInstanceUID,data:t}}(u),p=function(e){var t=e.SegmentationType;if("BINARY"===t)return ye.unpack(e.PixelData);var n=new Uint8Array(e.PixelData),a=e.MaximumFractionalValue,i=void 0===n.find((function(e){return 0!==e&&e!==a}));if(!i)return void r.cM.warn("This is a fractional segmentation, which is not currently supported.");return r.cM.warn("This segmentation object is actually binary... processing as such."),n}(u),g=u.PerFrameFunctionalGroupsSequence,m={},y=!0,v=0;v<g.length;v++){var I=g[v],T=l||I.PlaneOrientationSequence.ImageOrientationPatient,w=xe(i()(new Uint8Array(p.buffer,v*d,d),[u.Rows,u.Columns]),T,c);if(!w){console.warn("This segmentation object is not in-plane with the source data. Bailing out of IO. It'd be better to render this with vtkjs. "),y=!1;break}var b=I.SegmentIdentificationSequence.ReferencedSegmentNumber-1;De(m,Oe(f.DerivationImageSequence&&f.DerivationImageSequence.SourceImageSequence?f.DerivationImageSequence.SourceImageSequence[v]:I.DerivationImageSequence.SourceImageSequence,e,n),b,w)}if(!y)return;return{toolState:m,segMetadata:h}}};function be(e,t,n,r,a){for(var i=new Uint8Array(a.xy*t.length),o=0,u=0;u<t.length;u++)for(var s=n[r[t[u]].imageId].brush.data[e].pixelData,c=0;c<s.length;c++)i[o]=s[c],o++;return i}function Ce(e,t){for(var n=0,r=0;r<t.length;r++)t[r]&&n++;return n}function De(e,t,n,r){e[t]?e[t].brush?e[t].brush.data||(e[t].brush.data=[]):(e[t].brush={},e[t].brush.data=[]):(e[t]={},e[t].brush={},e[t].brush.data=[]),e[t].brush.data[n]={};var a=e[t].brush.data[n];a.pixelData=new Uint8Array(r.data.length);for(var i=a.pixelData,o=0;o<i.length;o++)r.data[o]?i[o]=1:i[o]=0}function Oe(e,t,n){var r=e.ReferencedSOPInstanceUID,a=e.ReferencedFrameNumber;return a?function(e,t,n,r){var a=n.find((function(n){var a=r.get("sopCommonModule",n);if(a){var i=Number(n.split("frame=")[1]);return a.sopInstanceUID===e&&i===t-1}}));return a}(r,a,t,n):function(e,t,n){return t.find((function(t){var r=n.get("sopCommonModule",t);if(r)return r.sopInstanceUID===e}))}(r,t,n)}function xe(e,t,n){return Ae(t,n[0])?e:Ae(t,n[1])?pe.v(e):Ae(t,n[2])?pe.h(e):Ae(t,n[3])?ge(e):Ae(t,n[4])?pe.h(ge(e)):Ae(t,n[5])?pe.v(ge(e)):Ae(t,n[6])?ge(ge(e)):Ae(t,n[7])?ge(ge(ge(e))):void 0}var Ee,Re=1e-5;function Ae(e,t){return Math.abs(e[0]-t[0])<Re&&Math.abs(e[1]-t[1])<Re&&Math.abs(e[2]-t[2])<Re&&Math.abs(e[3]-t[3])<Re&&Math.abs(e[4]-t[4])<Re&&Math.abs(e[5]-t[5])<Re}!function(e){e.SEGMENTATION_LOAD_PROGRESS="CORNERSTONE_ADAPTER_SEGMENTATION_LOAD_PROGRESS"}(Ee||(Ee={}));var Me=Ee,Pe=Object.freeze({__proto__:null,Events:Me}),Ne=r.hC.orientation,Ue=Ne.rotateDirectionCosinesInPlane,Be=Ne.flipImageOrientationPatient,_e=Ne.flipMatrix2D,ke=Ne.rotateMatrix902D,qe=Ne.nearlyEqual,Le=r.aT.datasetToDict,Ve=r.aT.BitArray,Ge=r.aT.DicomMessage,je=r.aT.DicomMetaDictionary,Fe=r.oq.Normalizer,Ye=r.U7.Segmentation,ze=r.hC.compression,He=ze.encode,We=ze.decode,Xe={includeSliceSpacing:!0,rleEncode:!1};function Je(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=Object.assign({},Xe,n),a=Array.isArray(t)?t:[t],i=0,o=[],u=function(){for(var e=a[c],t=e.labelmaps2D,n=e.metadata,r=[],u=1;u<n.length;u++)n[u]&&(r[u]=[]);for(var s=function(e){var n=t[e];t[e]&&n.segmentsOnLabelmap.forEach((function(t){0!==t&&(r[t].push(e),i++)}))},f=0;f<t.length;f++)s(f);o[c]=r},c=0;c<a.length;c++)u();e.setNumberOfFrames(i);for(var f=0;f<a.length;f++)for(var l=o[f],d=a[f],h=d.metadata,p=1;p<l.length;p++){var g=l[p];if(g){var m=g.map((function(e){return e+1})),y=h[p],v=Ke(d,g);e.addSegmentFromLabelmap(y,v,p,m)}}if(r.rleEncode){var S=He(e.dataset.PixelData,i,e.dataset.Rows,e.dataset.Columns);e.assignToDataset({BitsAllocated:"8",BitsStored:"8",HighBit:"7",SegmentationType:"FRACTIONAL",SegmentationFractionalType:"PROBABILITY",MaximumFractionalValue:"255"}),e.dataset._meta.TransferSyntaxUID={Value:["1.2.840.10008.1.2.5"],vr:"UI"},e.dataset._vrMap.PixelData="OB",e.dataset.PixelData=S}else e.bitPackPixelData();var I=s.lW.from(Le(e.dataset).write());return new Blob([I],{type:"application/dicom"})}function Ke(e,t){for(var n=e.labelmaps2D,r=[],a=0;a<t.length;a++){var i=t[a];r.push(n[i].pixelData)}return r}function Qe(){var e;return e=d().mark((function e(t,n,r,a){var i,o,u,s,c,f,l,h,p,g,m,y,v,I,T,w,b,C,D,O,x,E,R,A,M,P,N,U,B,_,k,q,L,V;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=a.skipOverlapping,o=void 0!==i&&i,u=a.tolerance,s=void 0===u?.001:u,c=a.TypedArrayConstructor,f=void 0===c?Uint8Array:c,l=a.maxBytesPerChunk,h=void 0===l?199e6:l,p=a.eventTarget,g=a.triggerEvent,m=Ge.readFile(n),(y=je.naturalizeDataset(m.dict))._meta=je.namifyDataset(m.meta),v=Fe.normalizeToDataset([y]),I=r.get("imagePlaneModule",t[0]),T=r.get("generalSeriesModule",t[0]),w=T.seriesInstanceUID,I||console.warn("Insufficient metadata, imagePlaneModule missing."),b=Array.isArray(I.rowCosines)?[].concat(S(I.rowCosines),S(I.columnCosines)):[I.rowCosines.x,I.rowCosines.y,I.rowCosines.z,I.columnCosines.x,I.columnCosines.y,I.columnCosines.z],C=it(b),D=v.Columns*v.Rows,O=st(v,w),"1.2.840.10008.1.2.5"!==v._meta.TransferSyntaxUID.Value[0]){e.next=23;break}if(R=Array.isArray(v.PixelData)?v.PixelData:[v.PixelData],x=We(R,v.Rows,v.Columns),1!==v.BitsStored){e.next=20;break}return console.warn("No implementation for rle + bitbacking."),e.abrupt("return");case 20:E=[x],e.next=26;break;case 23:if(E=at(v,{maxBytesPerChunk:h})){e.next=26;break}throw new Error("Fractional segmentations are not yet supported");case 26:A=rt(v,C,[I.rows,I.columns,t.length],s),M=t.reduce((function(e,t){return e[r.get("generalImageModule",t).sopInstanceUid]=t,e}),{}),P=!1,o||(P=$e(E,v,t,C,r,s,f,M)),e.t0=A,e.next="Planar"===e.t0?33:"Perpendicular"===e.t0?35:"Oblique"===e.t0?36:37;break;case 33:return N=P?et:nt,e.abrupt("break",37);case 35:throw new Error("Segmentations orthogonal to the acquisition plane of the source data are not yet supported.");case 36:throw new Error("Segmentations oblique to the acquisition plane of the source data are not yet supported.");case 37:return(U=[])[0]=[],B=[],_=D*t.length*f.BYTES_PER_ELEMENT,(k=[])[0]=new ArrayBuffer(_),q=t.reduce((function(e,t,n){return e.indices[t]=n,e.metadata[t]=r.get("instance",t),e}),{indices:{},metadata:{}}),L=new Map,e.next=47,N(B,U,k,E,v,t,C,r,s,f,L,M,q,p,g);case 47:return V=new Map,L.forEach((function(e,t){var n=ft(e,v),r=n.xAcc,a=n.yAcc,i=n.zAcc,o=n.count;V.set(t,{x:Math.floor(r/o),y:Math.floor(a/o),z:Math.floor(i/o)})})),e.abrupt("return",{labelmapBufferArray:k,segMetadata:O,segmentsOnFrame:B,segmentsOnFrameArray:U,centroids:V});case 50:case"end":return e.stop()}}),e)})),Qe=function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){h(i,r,a,o,u,"next",e)}function u(e){h(i,r,a,o,u,"throw",e)}o(void 0)}))},Qe.apply(this,arguments)}function Ze(e,t,n,r,a,i){var o=void 0;if(!e)return o;var u=e.FrameOfReferenceUID,s=e.PerFrameFunctionalGroupsSequence,c=e.SourceImageSequence,f=e.ReferencedSeriesSequence;if(!s||0===s.length)return o;var l=s[t];if(!l)return o;var d=void 0;if(c&&0!==c.length)d=c[t];else if(l.DerivationImageSequence){var h=l.DerivationImageSequence;Array.isArray(h)&&(h=0!==h.length?h[0]:void 0),h&&(d=h.SourceImageSequence,Array.isArray(d)&&(d=0!==d.length?d[0]:void 0))}(d&&(o=function(e,t){var n=e.ReferencedSOPInstanceUID,r=e.ReferencedFrameNumber;return r?function(e,t,n){var r=n[e];if(!r)return;var a=Number(r.split("frame=")[1]);return a===t-1?r:void 0}(n,r,t):t[n]}(d,i)),void 0===o&&f)&&(o=function(e,t,n,r,a,i){if(void 0===e||void 0===n.PlanePositionSequence||void 0===n.PlanePositionSequence[0]||void 0===n.PlanePositionSequence[0].ImagePositionPatient)return;for(var o=0;o<r.length;++o){var u=a.get("instance",r[o]);if(void 0!==u&&void 0!==u.ImagePositionPatient&&u.FrameOfReferenceUID===t&&u.SeriesInstanceUID===e&&ut(n.PlanePositionSequence[0].ImagePositionPatient,u.ImagePositionPatient,i))return r[o]}}((Array.isArray(f)?f[0]:f).SeriesInstanceUID,u,l,n,r,a));return o}function $e(e,t,n,r,a,o,u,s){var c=t.SharedFunctionalGroupsSequence,f=t.PerFrameFunctionalGroupsSequence,l=t.SegmentSequence,d=t.Rows,h=t.Columns;if(l.length<2)return!1;for(var p=c.PlaneOrientationSequence?c.PlaneOrientationSequence.ImageOrientationPatient:void 0,g=h*d,m=f.length,y=new Map,S=function(){if(void 0===tt(t,I))return console.warn("Could not retrieve the segment index for frame segment "+I+", skipping this frame."),"continue";var e=Ze(t,I,n,a,o,s);if(!e)return console.warn("Image not present in stack, can't import frame : "+I+"."),"continue";var r=n.findIndex((function(t){return t===e}));if(y.has(r)){var i=y.get(r);i.includes(I)||(i.push(I),y.set(r,i))}else y.set(r,[I])},I=0;I<m;++I)S();var T,b=w(y.entries());try{for(b.s();!(T=b.n()).done;)for(var C=v(T.value,2)[1],D=new u(g).fill(0),O=0;O<C.length;++O){var x=C[O],E=f[x],R=p||E.PlaneOrientationSequence.ImageOrientationPatient,A=ct(e,x*g,g),M=ot(i()(A,[d,h]),R,r,o);if(M){for(var P=M.data,N=0,U=P.length;N<U;++N)if(0!==P[N]&&(D[N]++,D[N]>1))return!0}else console.warn("Individual SEG frames are out of plane with respect to the first SEG frame, this is not yet supported, skipping this frame.")}}catch(e){b.e(e)}finally{b.f()}return!1}function et(e,t,n,r,a,o,s,c,f,l,d,h){for(var p=a.SharedFunctionalGroupsSequence,g=a.PerFrameFunctionalGroupsSequence,m=a.Rows,y=a.Columns,v=p.PlaneOrientationSequence?p.PlaneOrientationSequence.ImageOrientationPatient:void 0,S=y*m,I=S*o.length*l.BYTES_PER_ELEMENT,T=1,w=0,b=n[w].slice(0),C=u()(t[w]),D=a.SegmentSequence.length,O=1;O<=D;++O){for(var x=function(d){var p=g[d],D=tt(a,d);if(void 0===D)throw new Error("Could not retrieve the segment index. Aborting segmentation loading.");if(D!==O)return E=d,"continue";var x=v||p.PlaneOrientationSequence.ImageOrientationPatient,R=ct(r,d*S,S),A=ot(i()(R,[m,y]),x,s,f);if(!A)throw new Error("Individual SEG frames are out of plane with respect to the first SEG frame. This is not yet supported. Aborting segmentation loading.");var M=Ze(a,d,o,c,f,h);if(!M)return console.warn("Image not present in stack, can't import frame : "+d+"."),E=d,"continue";var P=c.get("instance",M);if(m!==P.Rows||y!==P.Columns)throw new Error("Individual SEG frames have different geometry dimensions (Rows and Columns) respect to the source image reference frame. This is not yet supported. Aborting segmentation loading. ");for(var N=o.findIndex((function(e){return e===M})),U=S*N*l.BYTES_PER_ELEMENT,B=new l(b,U,S),_=A.data,k=!1,q=0,L=A.data.length;q<L;++q)if(_[q]){if(0!==B[q]){++w>=T&&(n[w]=new ArrayBuffer(I),t[w]=[],T++),b=n[w].slice(0),C=u()(t[w]),d=0;break}B[q]=D,k=!0}k&&(C[N]||(C[N]=[]),C[N].push(D),e[N]||(e[N]=[]),e[N].push(D)),E=d},E=0,R=g.length;E<R;++E)x(E);n[w]=b.slice(0),t[w]=u()(C),b=n[w=0].slice(0),C=u()(t[w])}}var tt=function(e,t){var n=e.PerFrameFunctionalGroupsSequence,r=e.SharedFunctionalGroupsSequence,a=n[t];return a&&a.SegmentIdentificationSequence?a.SegmentIdentificationSequence.ReferencedSegmentNumber:r.SegmentIdentificationSequence?r.SegmentIdentificationSequence.ReferencedSegmentNumber:void 0};function nt(e,t,n,r,a,o,u,s,c,f,l,d,h,p,g){var m=a.SharedFunctionalGroupsSequence,y=a.PerFrameFunctionalGroupsSequence,v=a.Rows,S=a.Columns,I=m.PlaneOrientationSequence?m.PlaneOrientationSequence.ImageOrientationPatient:void 0,T=S*v,w=0,b=y.length,C=Math.ceil(b/10),D=g&&p;return new Promise((function(t){!function m(){for(var O=Math.min(w+C,b);w<O;++w){var x=y[w],E=I||x.PlaneOrientationSequence.ImageOrientationPatient,R=ct(r,w*T,T),A=ot(i()(R,[v,S]),E,u,c);if(!A)throw new Error("Individual SEG frames are out of plane with respect to the first SEG frame. This is not yet supported. Aborting segmentation loading.");var M=tt(a,w);if(void 0===M)throw new Error("Could not retrieve the segment index. Aborting segmentation loading.");l.has(M)||l.set(M,{});var P=Ze(a,w,o,s,c,d);if(P){var N=h.metadata[P];if(v!==N.Rows||S!==N.Columns)throw new Error("Individual SEG frames have different geometry dimensions (Rows and Columns) respect to the source image reference frame. This is not yet supported. Aborting segmentation loading. ");for(var U=h.indices[P],B=T*U*f.BYTES_PER_ELEMENT,_=new f(n[0],B,T),k=A.data,q=[],L=0,V=A.data.length;L<V;++L)if(k[L]){for(var G=L;G<V;++G)k[G]&&(_[G]=M,q.push(G));e[U]||(e[U]=[]),e[U].push(M);break}var j=l.get(M);j[U]=q,l.set(M,j)}else console.warn("Image not present in stack, can't import frame : "+w+".")}if(D){var F=Math.round(w/b*100);g(p,Me.SEGMENTATION_LOAD_PROGRESS,{percentComplete:F})}w<b?setTimeout(m,0):t()}()}))}function rt(e,t,n,r){var a=e.SharedFunctionalGroupsSequence,i=e.PerFrameFunctionalGroupsSequence,o=a.PlaneOrientationSequence?a.PlaneOrientationSequence.ImageOrientationPatient:void 0,u=i[0],s=o||u.PlaneOrientationSequence.ImageOrientationPatient;return t.some((function(e){return ut(s,e,r)}))?"Planar":function(e,t,n){var r=Math.abs(e[0]*t[0]+e[1]*t[1]+e[2]*t[2]),a=Math.abs(e[3]*t[3]+e[4]*t[4]+e[5]*t[5]);return(r<n||Math.abs(r-1)<n)&&(a<n||Math.abs(a-1)<n)}(s,t[0],r)&&n.includes(e.Rows)&&n.includes(e.Columns)?"Perpendicular":"Oblique"}function at(e,t){var n,a=e.SegmentationType;if(void 0===(n=Array.isArray(e.PixelData)?e.PixelData[0]:e.PixelData)&&r.cM.error("This segmentation pixeldata is undefined."),"BINARY"===a)return function(e,t){for(var n=new Uint8Array(e),r=[],a=8*t,i=Math.ceil(8*n.length/a),o=0;o<i;o++){var u=o*a,s=Math.min(u+a,8*n.length),c=Math.floor(u/8),f=Math.ceil(s/8),l=n.slice(c,f),d=Ve.unpack(l);r.push(d)}return r}(n,t.maxBytesPerChunk);var i=new Uint8Array(n),o=e.MaximumFractionalValue;return void 0===i.find((function(e){return 0!==e&&e!==o}))?(r.cM.warn("This segmentation object is actually binary... processing as such."),i):void 0}function it(e){var t=[];t[0]=e,t[1]=Be.h(e),t[2]=Be.v(e);var n=Ue(e,Math.PI/2);return t[3]=n,t[4]=Be.h(n),t[5]=Be.v(n),t[6]=Ue(e,Math.PI),t[7]=Ue(e,1.5*Math.PI),t}function ot(e,t,n,r){return ut(t,n[0],r)?e:ut(t,n[1],r)?_e.v(e):ut(t,n[2],r)?_e.h(e):ut(t,n[3],r)?ke(e):ut(t,n[4],r)?ke(_e.h(e)):ut(t,n[5],r)?ke(_e.v(e)):ut(t,n[6],r)?ke(ke(e)):ut(t,n[7],r)?ke(ke(ke(e))):void 0}function ut(e,t,n){if(e.length!=t.length)return!1;for(var r=0;r<e.length;++r)if(!qe(e[r],t[r],n))return!1;return!0}function st(e,t){var n=e.SegmentSequence;return{seriesInstanceUid:t,data:Array.isArray(n)?[void 0].concat(S(n)):[void 0,n]}}function ct(e,t,n){var r=function(e,t,n){var r=e.reduce((function(e,t){return e+t.length}),0);if(t<0||t+n>r)throw new Error("Offset and length out of bounds");var a=0,i=t;for(;i>=e[a].length;)i-=e[a].length,a++;var o=a,u=i+n;for(;u>e[o].length;)u-=e[o].length,o++;return{start:{chunkIndex:a,offset:i},end:{chunkIndex:o,offset:u}}}(e,t,n);if(r.start.chunkIndex===r.end.chunkIndex)return new Uint8Array(e[r.start.chunkIndex].buffer,r.start.offset,n);for(var a=new Uint8Array(n),i=0,o=r.start.chunkIndex;o<=r.end.chunkIndex;o++){var u=o===r.start.chunkIndex?r.start.offset:0,s=o===r.end.chunkIndex?r.end.offset:e[o].length;a.set(new Uint8Array(e[o].buffer,u,s-u),i),i+=s-u}return a}function ft(e,t){for(var n=0,r=0,a=0,i=0,o=0,u=Object.entries(e);o<u.length;o++){var s=v(u[o],2),c=s[0],f=s[1],l=Number(c);if(f&&0!==f.length){var d,h=w(f);try{for(h.s();!(d=h.n()).done;){var p=d.value,g=Math.floor(p/t.Rows);n+=p%t.Rows,r+=g,a+=l,i++}}catch(e){h.e(e)}finally{h.f()}}}return{xAcc:n,yAcc:r,zAcc:a,count:i}}var lt={generateSegmentation:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e[0].imageId.includes("?frame");return Je(function(e,t,n){var r=[];if(t){var a=e[0].data.byteArray.buffer,i=Ge.readFile(a),o=je.naturalizeDataset(i.dict);o._meta=je.namifyDataset(i.meta),r.push(o)}else for(var u=0;u<e.length;u++){var s=e[u].data.byteArray.buffer,c=Ge.readFile(s),f=je.naturalizeDataset(c.dict);f._meta=je.namifyDataset(c.meta),r.push(f)}var l=Fe.normalizeToDataset(r);return new Ye([l],n)}(e,r,n),t,n)},generateToolState:function(e,t,n,r){return Qe.apply(this,arguments)},fillSegmentation:Je};var dt={Length:G,FreehandRoi:F,Bidirectional:H,EllipticalRoi:J,CircleRoi:Z,ArrowAnnotate:ne,MeasurementReport:k,CobbAngle:ie,Angle:se,RectangleRoi:fe},ht={Segmentation:{generateSegmentation:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{includeSliceSpacing:!0},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(4===r)return lt.generateSegmentation(e,t,n);if(3===r)return we.generateSegmentation(e,t,n);console.warn("No generateSegmentation adapater for cornerstone version ".concat(r,", exiting."))},generateToolState:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4;if(4===i)return lt.generateToolState(e,t,n,r,a);if(3===i)return we.generateToolState(e,t,n);console.warn("No generateToolState adapater for cornerstone version ".concat(i,", exiting."))},fillSegmentation:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{includeSliceSpacing:!0},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(4===r)return lt.fillSegmentation(e,t,n);console.warn("No generateSegmentation adapater for cornerstone version ".concat(r,", exiting."))}}},pt=function(){return pt=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},pt.apply(this,arguments)};function gt(e,t,n){if(n||2===arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))}var mt="Cornerstone3DTools@^0.1.0",yt={CodingSchemeDesignator:"CORNERSTONEJS",codeValues:{CORNERSTONEFREETEXT:"CORNERSTONEFREETEXT"}},vt=r.hC.TID1500,St=r.hC.addAccessors,It=r.U7.StructuredReport,Tt=r.oq.Normalizer,wt=vt.TID1500MeasurementReport,bt=vt.TID1501MeasurementGroup,Ct=r.aT.DicomMetaDictionary,Dt={CodingSchemeDesignator:"DCM",CodeValue:"121071"},Ot={CodingSchemeDesignator:"SCT",CodeValue:"363698007"},xt={CodingSchemeDesignator:"SRT",CodeValue:"G-C0E3"},Et=function(e,t,n){var r=e.ConceptNameCodeSequence;if(r){var a=r.CodingSchemeDesignator,i=r.CodeValue;return a==t.CodingSchemeDesignator&&i==t.CodeValue||n&&a==n.CodingSchemeDesignator&&i==n.CodeValue}};function Rt(e,t,n,r){var a=t[e],i=At.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE[e];if(a&&a.data&&a.data.length&&i){var o=a.data.map((function(e){return function(e,t,n,r,a){var i=r.getTID300RepresentationArguments(e,a);return i.ReferencedSOPSequence=n,new r.TID300Representation(i)}(e,0,n,i,r)}));return new bt(o)}}var At=function(){function e(){}return e.getCornerstoneLabelFromDefaultState=function(e){var t=e.findingSites,n=void 0===t?[]:t,r=e.finding,a=yt.codeValues.CORNERSTONEFREETEXT,i=n.find((function(e){return e.CodeValue===a}));return i?i.CodeMeaning:r&&r.CodeValue===a?r.CodeMeaning:void 0},e.generateDatasetMeta=function(){var e=new Uint8Array(2);return e[1]=1,{FileMetaInformationVersion:{Value:[e.buffer],vr:"OB"},TransferSyntaxUID:{Value:["1.2.840.10008.1.2.1"],vr:"UI"},ImplementationClassUID:{Value:[Ct.uid()],vr:"UI"},ImplementationVersionName:{Value:["dcmjs"],vr:"SH"}}},e.getSetupMeasurementData=function(t,n,r,a){var i=t.ContentSequence,o=C(i),u=o.find((function(e){return Et(e,Dt)})),s=o.filter((function(e){return Et(e,Ot,xt)}))||[],c=o.find((function(e){return"NUM"===e.ValueType})),f=C(c.ContentSequence).find((function(e){return"SCOORD"===e.ValueType})),l=f.ContentSequence.ReferencedSOPSequence,d=l.ReferencedSOPInstanceUID,h=l.ReferencedFrameNumber,p=n[d],g=r.get("imagePlaneModule",p),m=u?St(u.ConceptCodeSequence):void 0,y=s.map((function(e){return St(e.ConceptCodeSequence)})),v={description:void 0,sopInstanceUid:d,annotation:{annotationUID:Ct.uid(),metadata:{toolName:a,referencedImageId:p,FrameOfReferenceUID:g.frameOfReferenceUID,label:""},data:void 0},finding:m,findingSites:y};return v.finding&&(v.description=v.finding.CodeMeaning),v.annotation.metadata.label=e.getCornerstoneLabelFromDefaultState(v),{defaultState:v,NUMGroup:c,SCOORDGroup:f,ReferencedSOPSequence:l,ReferencedSOPInstanceUID:d,ReferencedFrameNumber:h}},e.generateReport=function(t,n,r,a){var i=[],o={},u=[],s=e.generateDatasetMeta();Object.keys(t).forEach((function(a){var s=n.get("sopCommonModule",a),c=n.get("instance",a),f=s.sopInstanceUID,l=s.sopClassUID,d=c.SeriesInstanceUID;if(o[f]=d,!u.find((function(e){return e.SeriesInstanceUID===d}))){var h=e.generateDerivationSourceDataset(c);u.push(h)}var p=n.get("frameNumber",a),g=t[a],m=Object.keys(g),y={ReferencedSOPClassUID:l,ReferencedSOPInstanceUID:f,ReferencedFrameNumber:void 0};(c&&c.NumberOfFrames&&c.NumberOfFrames>1||Tt.isMultiframeSOPClassUID(l))&&(y.ReferencedFrameNumber=p);var v=[];m.forEach((function(e){var t=Rt(e,g,y,r);t&&v.push(t)})),i=i.concat(v)}));var c=new wt({TID1501MeasurementGroups:i},a),f=new It(u,a),l=c.contentItem(u,pt(pt({},a),{sopInstanceUIDsToSeriesInstanceUIDMap:o}));return f.dataset=Object.assign(f.dataset,l),f.dataset._meta=s,f},e.generateToolState=function(t,n,r,a,i){if("1500"!==t.ContentTemplateSequence.TemplateIdentifier)throw new Error("This package can currently only interpret DICOM SR TID 1500");var o=C(t.ContentSequence).find(D("Imaging Measurements")),u=C(o.ContentSequence).filter(D("Measurement Group")),s={},c=e.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE,f=[];return Object.keys(c).forEach((function(e){f.push(c[e]),s[e]=[]})),u.forEach((function(e){var o;try{var u=C(e.ContentSequence).find((function(e){return"Tracking Identifier"===e.ConceptNameCodeSequence.CodeMeaning})).TextValue,c=(null===(o=null==i?void 0:i.getToolClass)||void 0===o?void 0:o.call(i,e,t,f))||f.find((function(e){return e.isValidCornerstoneTrackingIdentifier(u)}));if(c){var l=c.getMeasurementData(e,n,r,a);console.log("=== ".concat(c.toolType," ===")),console.log(l),s[c.toolType].push(l)}}catch(t){console.warn("Unable to generate tool state for",e,t)}})),s},e.registerTool=function(t){e.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE[t.utilityToolType]=t,e.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE[t.toolType]=t,e.MEASUREMENT_BY_TOOLTYPE[t.toolType]=t.utilityToolType},e.CORNERSTONE_3D_TAG=mt,e.MEASUREMENT_BY_TOOLTYPE={},e.CORNERSTONE_TOOL_CLASSES_BY_UTILITY_TYPE={},e.CORNERSTONE_TOOL_CLASSES_BY_TOOL_TYPE={},e.generateDerivationSourceDataset=function(t){var n=e.generateDatasetMeta();return pt(pt({},t),{_meta:n,_vrMap:{PixelData:"OW"}})},e}(),Mt=r.hC.TID300.Point,Pt="ArrowAnnotate",Nt="".concat(mt,":").concat(Pt),Ut=yt.codeValues,Bt=yt.CodingSchemeDesignator,_t=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(t,n,r,a){for(var i=At.getSetupMeasurementData(t,n,a,e.toolType),o=i.defaultState,u=i.SCOORDGroup,s=i.ReferencedFrameNumber,c=o.annotation.metadata.referencedImageId,f=o.annotation.metadata.label,l=u.GraphicData,d=[],h=0;h<l.length;h+=2){var p=r(c,[l[h],l[h+1]]);d.push(p)}if(1===d.length){var g=a.get("imagePixelModule",c),m=10,y=10;if(g)m=g.columns/10,y=g.rows/10;var v=r(c,[l[0]+m,l[1]+y]);d.push(v)}var S=o;return S.annotation.data={text:f,handles:{arrowFirst:!0,points:[d[0],d[1]],activeHandleIndex:0,textBox:{hasMoved:!1}},frameNumber:s},S}},{key:"getTID300RepresentationArguments",value:function(e,t){var n=e.data,r=e.metadata,a=e.finding,i=e.findingSites,o=r.referencedImageId;if(!o)throw new Error("ArrowAnnotate.getTID300RepresentationArguments: referencedImageId is not defined");var u=n.handles,s=u.points,c=t(o,u.arrowFirst?s[0]:s[1]),f={points:[{x:c[0],y:c[1]}],trackingIdentifierTextValue:Nt,findingSites:i||[]};return a&&a.CodeValue===Ut.CORNERSTONEFREETEXT||(a={CodeValue:Ut.CORNERSTONEFREETEXT,CodingSchemeDesignator:Bt,CodeMeaning:n.text}),f.finding=a,f}}]),e}();_t.toolType=Pt,_t.utilityToolType=Pt,_t.TID300Representation=Mt,_t.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=v(e.split(":"),2),n=t[0],r=t[1];return n===mt&&r===Pt},At.registerTool(_t);var kt=r.hC.TID300.Bidirectional,qt="Bidirectional",Lt="".concat(mt,":").concat(qt),Vt=function(){function e(){}return e.getMeasurementData=function(t,n,r,a){var i,o=At.getSetupMeasurementData(t,n,a,e.toolType),u=o.defaultState,s=o.ReferencedFrameNumber,c=u.annotation.metadata.referencedImageId,f=t.ContentSequence,l=C(f).find((function(e){return"Long Axis"===e.ConceptNameCodeSequence.CodeMeaning})),d=C(l.ContentSequence).find((function(e){return"SCOORD"===e.ValueType})),h=C(f).find((function(e){return"Short Axis"===e.ConceptNameCodeSequence.CodeMeaning})),p=C(h.ContentSequence).find((function(e){return"SCOORD"===e.ValueType})),g=[];[d,p].forEach((function(e){for(var t=e.GraphicData,n=0;n<t.length;n+=2){var a=r(c,[t[n],t[n+1]]);g.push(a)}}));var m=u;return m.annotation.data={handles:{points:[g[0],g[1],g[2],g[3]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:(i={},i["imageId:".concat(c)]={length:l.MeasuredValueSequence.NumericValue,width:h.MeasuredValueSequence.NumericValue},i),frameNumber:s},m},e.getTID300RepresentationArguments=function(e,t){var n=e.data,r=e.finding,a=e.findingSites,i=e.metadata,o=n.cachedStats,u=void 0===o?{}:o,s=n.handles,c=i.referencedImageId;if(!c)throw new Error("Bidirectional.getTID300RepresentationArguments: referencedImageId is not defined");var f,l,d=u["imageId:".concat(c)]||{},h=d.length,p=d.width,g=s.points,m=[g[0],g[1]],y=[g[2],g[3]];Math.sqrt(Math.pow(m[0][0]-m[1][0],2)+Math.pow(m[0][1]-m[1][1],2)+Math.pow(m[0][2]-m[1][2],2))>Math.sqrt(Math.pow(y[0][0]-y[1][0],2)+Math.pow(y[0][1]-y[1][1],2)+Math.pow(y[0][2]-y[1][2],2))?(f=m,l=y):(f=y,l=m);var v=t(c,f[0]),S=t(c,f[1]),I=t(c,l[0]),T=t(c,l[1]);return{longAxis:{point1:{x:v[0],y:v[1]},point2:{x:S[0],y:S[1]}},shortAxis:{point1:{x:I[0],y:I[1]},point2:{x:T[0],y:T[1]}},longAxisLength:h,shortAxisLength:p,trackingIdentifierTextValue:Lt,finding:r,findingSites:a||[]}},e.toolType=qt,e.utilityToolType=qt,e.TID300Representation=kt,e.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=e.split(":"),n=t[0],r=t[1];return n===mt&&r===qt},e}();At.registerTool(Vt);var Gt=r.hC.TID300.CobbAngle,jt="Angle",Ft="".concat(mt,":").concat(jt),Yt=function(){function e(){}return e.getMeasurementData=function(t,n,r,a){for(var i,o=At.getSetupMeasurementData(t,n,a,e.toolType),u=o.defaultState,s=o.NUMGroup,c=o.SCOORDGroup,f=o.ReferencedFrameNumber,l=u.annotation.metadata.referencedImageId,d=c.GraphicData,h=[],p=0;p<d.length;p+=2){var g=r(l,[d[p],d[p+1]]);h.push(g)}var m=u;return m.annotation.data={handles:{points:[h[0],h[1],h[3]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:(i={},i["imageId:".concat(l)]={angle:s?s.MeasuredValueSequence.NumericValue:null},i),frameNumber:f},m},e.getTID300RepresentationArguments=function(e,t){var n=e.data,r=e.finding,a=e.findingSites,i=e.metadata,o=n.cachedStats,u=void 0===o?{}:o,s=n.handles,c=i.referencedImageId;if(!c)throw new Error("Angle.getTID300RepresentationArguments: referencedImageId is not defined");var f=t(c,s.points[0]),l=t(c,s.points[1]),d=t(c,s.points[2]),h={x:f[0],y:f[1]},p={x:l[0],y:l[1]};return{point1:h,point2:p,point3:p,point4:{x:d[0],y:d[1]},rAngle:(u["imageId:".concat(c)]||{}).angle,trackingIdentifierTextValue:Ft,finding:r,findingSites:a||[]}},e.toolType=jt,e.utilityToolType=jt,e.TID300Representation=Gt,e.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=e.split(":"),n=t[0],r=t[1];return n===mt&&r===jt},e}();At.registerTool(Yt);var zt=r.hC.TID300.CobbAngle,Ht="CobbAngle",Wt="".concat(mt,":").concat(Ht),Xt=function(){function e(){}return e.getMeasurementData=function(t,n,r,a){for(var i,o=At.getSetupMeasurementData(t,n,a,e.toolType),u=o.defaultState,s=o.NUMGroup,c=o.SCOORDGroup,f=o.ReferencedFrameNumber,l=u.annotation.metadata.referencedImageId,d=c.GraphicData,h=[],p=0;p<d.length;p+=2){var g=r(l,[d[p],d[p+1]]);h.push(g)}var m=u;return m.annotation.data={handles:{points:[h[0],h[1],h[2],h[3]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:(i={},i["imageId:".concat(l)]={angle:s?s.MeasuredValueSequence.NumericValue:null},i),frameNumber:f},m},e.getTID300RepresentationArguments=function(e,t){var n=e.data,r=e.finding,a=e.findingSites,i=e.metadata,o=n.cachedStats,u=void 0===o?{}:o,s=n.handles,c=i.referencedImageId;if(!c)throw new Error("CobbAngle.getTID300RepresentationArguments: referencedImageId is not defined");var f=t(c,s.points[0]),l=t(c,s.points[1]),d=t(c,s.points[2]),h=t(c,s.points[3]);return{point1:{x:f[0],y:f[1]},point2:{x:l[0],y:l[1]},point3:{x:d[0],y:d[1]},point4:{x:h[0],y:h[1]},rAngle:(u["imageId:".concat(c)]||{}).angle,trackingIdentifierTextValue:Wt,finding:r,findingSites:a||[]}},e.toolType=Ht,e.utilityToolType=Ht,e.TID300Representation=zt,e.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=e.split(":"),n=t[0],r=t[1];return n===mt&&r===Ht},e}();function Jt(e){if(!e.includes(":"))return!1;var t=e.split(":"),n=t[0],r=t[1];return n===mt&&r.toLowerCase()===this.toolType.toLowerCase()}At.registerTool(Xt);var Kt=r.hC.TID300.Circle,Qt="CircleROI",Zt=function(){function e(){}return e.getMeasurementData=function(t,n,r,a){for(var i,o=At.getSetupMeasurementData(t,n,a,e.toolType),u=o.defaultState,s=o.NUMGroup,c=o.SCOORDGroup,f=o.ReferencedFrameNumber,l=u.annotation.metadata.referencedImageId,d=c.GraphicData,h=[],p=0;p<d.length;p+=2){var g=r(l,[d[p],d[p+1]]);h.push(g)}var m=u;return m.annotation.data={handles:{points:gt([],h,!0),activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:(i={},i["imageId:".concat(l)]={area:s?s.MeasuredValueSequence.NumericValue:0,radius:0,perimeter:0},i),frameNumber:f},m},e.getTID300RepresentationArguments=function(e,t){var n=e.data,r=e.finding,a=e.findingSites,i=e.metadata,o=n.cachedStats,u=void 0===o?{}:o,s=n.handles,c=i.referencedImageId;if(!c)throw new Error("CircleROI.getTID300RepresentationArguments: referencedImageId is not defined");var f=t(c,s.points[0]),l=t(c,s.points[1]),d=[];d.push({x:f[0],y:f[1]}),d.push({x:l[0],y:l[1]});var h=u["imageId:".concat(c)]||{},p=h.area,g=h.radius;return{area:p,perimeter:2*Math.PI*g,radius:g,points:d,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:r,findingSites:a||[]}},e.trackingIdentifierTextValue="".concat(mt,":").concat(Qt),e.toolType=Qt,e.utilityToolType=Qt,e.TID300Representation=Kt,e.isValidCornerstoneTrackingIdentifier=Jt,e}();At.registerTool(Zt);var $t=r.hC.TID300.Ellipse,en="EllipticalROI",tn=1e-4,nn=function(){function e(){}return e.getMeasurementData=function(t,n,r,a){for(var i,o=At.getSetupMeasurementData(t,n,a,e.toolType),u=o.defaultState,s=o.NUMGroup,f=o.SCOORDGroup,l=o.ReferencedFrameNumber,d=u.annotation.metadata.referencedImageId,h=f.GraphicData,p=[],g=0;g<h.length;g+=2){var m=r(d,[h[g],h[g+1]]);p.push(m)}var y=c.R3.fromValues.apply(c.R3,p[0]),v=c.R3.fromValues.apply(c.R3,p[1]),S=c.R3.fromValues.apply(c.R3,p[2]),I=c.R3.fromValues.apply(c.R3,p[3]),T=c.R3.create();c.R3.sub(T,v,y),c.R3.normalize(T,T);var w=c.R3.create();c.R3.sub(w,I,S),c.R3.normalize(w,w);var b=a.get("imagePlaneModule",d);if(!b)throw new Error("imageId does not have imagePlaneModule metadata");var C=b.columnCosines,D=c.R3.fromValues(C[0],C[1],C[2]),O=c.R3.dot(D,T),x=c.R3.dot(D,w),E=Math.abs(O),R=Math.abs(x),A=[];Math.abs(E-1)<tn?A=[p[0],p[1],p[2],p[3]]:Math.abs(R-1)<tn?A=[p[2],p[3],p[0],p[1]]:console.warn("OBLIQUE ELLIPSE NOT YET SUPPORTED");var M=u;return M.annotation.data={handles:{points:gt([],A,!0),activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:(i={},i["imageId:".concat(d)]={area:s?s.MeasuredValueSequence.NumericValue:0},i),frameNumber:l},M},e.getTID300RepresentationArguments=function(e,t){var n,r,a,i,o=e.data,u=e.finding,s=e.findingSites,c=e.metadata,f=o.cachedStats,l=void 0===f?{}:f,d=o.handles,h=o.initialRotation||0,p=c.referencedImageId;if(!p)throw new Error("EllipticalROI.getTID300RepresentationArguments: referencedImageId is not defined");90==h||270==h?(r=t(p,d.points[2]),n=t(p,d.points[3]),a=t(p,d.points[0]),i=t(p,d.points[1])):(n=t(p,d.points[0]),r=t(p,d.points[1]),a=t(p,d.points[2]),i=t(p,d.points[3]));var g=[];return Math.abs(n[1]-r[1])>Math.abs(a[0]-i[0])?(g.push({x:n[0],y:n[1]}),g.push({x:r[0],y:r[1]}),g.push({x:a[0],y:a[1]}),g.push({x:i[0],y:i[1]})):(g.push({x:a[0],y:a[1]}),g.push({x:i[0],y:i[1]}),g.push({x:n[0],y:n[1]}),g.push({x:r[0],y:r[1]})),{area:(l["imageId:".concat(p)]||{}).area,points:g,trackingIdentifierTextValue:this.trackingIdentifierTextValue,finding:u,findingSites:s||[]}},e.trackingIdentifierTextValue="".concat(mt,":").concat(en),e.toolType=en,e.utilityToolType=en,e.TID300Representation=$t,e.isValidCornerstoneTrackingIdentifier=Jt,e}();At.registerTool(nn);var rn=r.hC.TID300.Polyline,an="RectangleROI",on="".concat(mt,":").concat(an),un=function(){function e(){}return e.getMeasurementData=function(t,n,r,a){for(var i,o=At.getSetupMeasurementData(t,n,a,e.toolType),u=o.defaultState,s=o.NUMGroup,c=o.SCOORDGroup,f=o.ReferencedFrameNumber,l=u.annotation.metadata.referencedImageId,d=c.GraphicData,h=[],p=0;p<d.length;p+=2){var g=r(l,[d[p],d[p+1]]);h.push(g)}var m=u;return m.annotation.data={handles:{points:[h[0],h[1],h[3],h[2]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:(i={},i["imageId:".concat(l)]={area:s?s.MeasuredValueSequence.NumericValue:null},i),frameNumber:f},m},e.getTID300RepresentationArguments=function(e,t){var n=e.data,r=e.finding,a=e.findingSites,i=e.metadata,o=n.cachedStats,u=void 0===o?{}:o,s=n.handles,c=i.referencedImageId;if(!c)throw new Error("CobbAngle.getTID300RepresentationArguments: referencedImageId is not defined");var f=s.points.map((function(e){return t(c,e)})),l=u.area,d=u.perimeter;return{points:[f[0],f[1],f[3],f[2],f[0]],area:l,perimeter:d,trackingIdentifierTextValue:on,finding:r,findingSites:a||[]}},e.toolType=an,e.utilityToolType=an,e.TID300Representation=rn,e.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=e.split(":"),n=t[0],r=t[1];return n===mt&&r===an},e}();At.registerTool(un);var sn=r.hC.TID300.Length,cn="Length",fn="".concat(mt,":").concat(cn),ln=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(t,n,r,a){for(var i=At.getSetupMeasurementData(t,n,a,e.toolType),o=i.defaultState,u=i.NUMGroup,s=i.SCOORDGroup,c=i.ReferencedFrameNumber,f=o.annotation.metadata.referencedImageId,l=s.GraphicData,d=[],h=0;h<l.length;h+=2){var p=r(f,[l[h],l[h+1]]);d.push(p)}var g=o;return g.annotation.data={handles:{points:[d[0],d[1]],activeHandleIndex:0,textBox:{hasMoved:!1}},cachedStats:y({},"imageId:".concat(f),{length:u?u.MeasuredValueSequence.NumericValue:0}),frameNumber:c},g}},{key:"getTID300RepresentationArguments",value:function(e,t){var n=e.data,r=e.finding,a=e.findingSites,i=e.metadata,o=n.cachedStats,u=void 0===o?{}:o,s=n.handles,c=i.referencedImageId;if(!c)throw new Error("Length.getTID300RepresentationArguments: referencedImageId is not defined");var f=t(c,s.points[0]),l=t(c,s.points[1]);return{point1:{x:f[0],y:f[1]},point2:{x:l[0],y:l[1]},distance:(u["imageId:".concat(c)]||{}).length,trackingIdentifierTextValue:fn,finding:r,findingSites:a||[]}}}]),e}();ln.toolType=cn,ln.utilityToolType=cn,ln.TID300Representation=sn,ln.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=v(e.split(":"),2),n=t[0],r=t[1];return n===mt&&r===cn},At.registerTool(ln);var dn=r.hC.TID300.Polyline,hn="PlanarFreehandROI",pn="".concat(mt,":").concat(hn),gn=function(){function e(){}return e.getMeasurementData=function(t,n,r,a){for(var i=At.getSetupMeasurementData(t,n,a,e.toolType),o=i.defaultState,u=i.SCOORDGroup,s=i.ReferencedFrameNumber,f=o.annotation.metadata.referencedImageId,l=u.GraphicData,d=[],h=0;h<l.length;h+=2){var p=r(f,[l[h],l[h+1]]);d.push(p)}var g=!0;c.R3.distance(d[d.length-1],d[0])<1e-5&&(d.pop(),g=!1);var m=[];g&&m.push(d[0],d[d.length-1]);var y=o;return y.annotation.data={polyline:d,isOpenContour:g,handles:{points:m,activeHandleIndex:null,textBox:{hasMoved:!1}},frameNumber:s},y},e.getTID300RepresentationArguments=function(e,t){var n=e.data,r=e.finding,a=e.findingSites,i=e.metadata,o=n.isOpenContour,u=n.polyline,s=i.referencedImageId;if(!s)throw new Error("PlanarFreehandROI.getTID300RepresentationArguments: referencedImageId is not defined");var c=u.map((function(e){return t(s,e)}));if(!o){var f=c[0];c.push([f[0],f[1]])}return{points:c,area:0,perimeter:0,trackingIdentifierTextValue:pn,finding:r,findingSites:a||[]}},e.toolType=hn,e.utilityToolType=hn,e.TID300Representation=dn,e.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=e.split(":"),n=t[0],r=t[1];return n===mt&&r===hn},e}();At.registerTool(gn);var mn=r.hC.TID300.Point,yn="Probe",vn="".concat(mt,":").concat(yn),Sn=function(){function e(){p(this,e)}return m(e,null,[{key:"getMeasurementData",value:function(t,n,r,a){for(var i=At.getSetupMeasurementData(t,n,a,e.toolType),o=i.defaultState,u=i.SCOORDGroup,s=i.ReferencedFrameNumber,c=o.annotation.metadata.referencedImageId,f=u.GraphicData,l=[],d=0;d<f.length;d+=2){var h=r(c,[f[d],f[d+1]]);l.push(h)}var p=o;return p.annotation.data={handles:{points:l,activeHandleIndex:null,textBox:{hasMoved:!1}},frameNumber:s},p}},{key:"getTID300RepresentationArguments",value:function(e,t){var n=e.data,r=e.metadata,a=e.finding,i=e.findingSites,o=r.referencedImageId;if(!o)throw new Error("Probe.getTID300RepresentationArguments: referencedImageId is not defined");return{points:n.handles.points.map((function(e){var n=t(o,e);return{x:n[0],y:n[1]}})),trackingIdentifierTextValue:vn,findingSites:i||[],finding:a}}}]),e}();Sn.toolType=yn,Sn.utilityToolType=yn,Sn.TID300Representation=mn,Sn.isValidCornerstoneTrackingIdentifier=function(e){if(!e.includes(":"))return!1;var t=v(e.split(":"),2),n=t[0],r=t[1];return n===mt&&r===yn},At.registerTool(Sn);var In=r.oq.Normalizer,Tn=r.U7.Segmentation;var wn=ht.Segmentation.generateToolState;var bn={Bidirectional:Vt,CobbAngle:Xt,Angle:Yt,Length:ln,CircleROI:Zt,EllipticalROI:nn,RectangleROI:un,ArrowAnnotate:_t,Probe:Sn,PlanarFreehandROI:gn,MeasurementReport:At,CodeScheme:yt,CORNERSTONE_3D_TAG:mt},Cn={Segmentation:Object.freeze({__proto__:null,generateLabelMaps2DFrom3D:function(e){for(var t=e.scalarData,n=e.dimensions,r=[],a=new Set,i=0;i<n[2];i++){for(var o=t.slice(i*n[0]*n[1],(i+1)*n[0]*n[1]),u=[],s=0;s<o.length;s++){var c=o[s];u.includes(c)||0===c||u.push(c)}var f={segmentsOnLabelmap:u,pixelData:o,rows:n[1],columns:n[0]};0!==u.length&&(u.forEach((function(e){a.add(e)})),r[n[2]-1-i]=f)}return e.segmentsOnLabelmap=Array.from(a),e.labelmaps2D=r,e},generateSegmentation:function(e,t,n,r){return Je(function(e,t,n){var r=e.map((function(e){var n=t.get("instance",e.imageId);return pt(pt(pt({},e),n),{SOPClassUID:n.SopClassUID,SOPInstanceUID:n.SopInstanceUID,PixelData:e.getPixelData(),_vrMap:{PixelData:"OW"},_meta:{}})})),a=In.normalizeToDataset(r);return new Tn([a],n)}(e,n,r),t,r)},generateToolState:function(e,t,n,r,a){return void 0===r&&(r=!1),void 0===a&&(a=.001),wn(e,t,n,r,a)}})},Dn=r.aT.Colors,On=r.aT.BitArray;function xn(e){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;switch(t){case 1:return Math.abs(e);case 2:return Math.sqrt(e[0]*e[0]+e[1]*e[1]);case 3:return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);default:for(var n=0,r=0;r<t;r++)n+=e[r]*e[r];return Math.sqrt(n)}}(e);return 0!==t&&(e[0]/=t,e[1]/=t,e[2]/=t),t}var En={Cornerstone:dt,Cornerstone3D:bn},Rn={Cornerstone:dt,Cornerstone3D:Cn,VTKjs:{Segmentation:function(){function e(){p(this,e)}return m(e,null,[{key:"generateSegments",value:function(e){"Array"!==e.SegmentSequence.constructor.name&&(e.SegmentSequence=[e.SegmentSequence]),e.SegmentSequence.forEach((function(e){var t,n,r=(t=e.RecommendedDisplayCIELabValue,(n=Dn.dicomlab2RGB(t).map((function(e){return Math.round(255*e)}))).push(255),n);segments[e.SegmentNumber]={color:r,functionalGroups:[],offset:null,size:null,pixelData:null}})),e.PerFrameFunctionalGroupsSequence.forEach((function(e){var t=e.SegmentIdentificationSequence.ReferencedSegmentNumber;segments[t].functionalGroups.push(e)}));var t=Math.ceil(e.Rows*e.Columns/8),n=0;return Object.keys(segments).forEach((function(r){var a=segments[r];a.numberOfFrames=a.functionalGroups.length,a.size=a.numberOfFrames*t,a.offset=n,n=a.offset+a.size;var i=e.PixelData.slice(a.offset,n);a.pixelData=On.unpack(i);var o=function(e,t){var n={},r=e.SharedFunctionalGroupsSequence.PixelMeasuresSequence,a=e.SharedFunctionalGroupsSequence.PlaneOrientationSequence,i=t[0],o=t[t.length-1],u=i.PlanePositionSequence.ImagePositionPatient.map(Number),s=o.PlanePositionSequence.ImagePositionPatient.map(Number);n.origin=u,n.spacing=[r.PixelSpacing[1],r.PixelSpacing[0],r.SpacingBetweenSlices].map(Number),n.dimensions=[e.Columns,e.Rows,t.length].map(Number);var c,f,l,d,h,p,g=a.ImageOrientationPatient.map(Number),m=g.slice(0,3),y=g.slice(3,6);return n.planeNormal=[],c=m,f=y,l=n.planeNormal,d=c[1]*f[2]-c[2]*f[1],h=c[2]*f[0]-c[0]*f[2],p=c[0]*f[1]-c[1]*f[0],l[0]=d,l[1]=h,l[2]=p,n.sliceStep=[],function(e,t,n){n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2]}(s,u,n.sliceStep),xn(n.sliceStep),n.direction=m.concat(y).concat(n.sliceStep),n}(e,a.functionalGroups);a.geometry=o})),segments}}]),e}()}}},3506:(e,t)=>{"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,i=u(e),o=i[0],s=i[1],c=new a(function(e,t,n){return 3*(t+n)/4-n}(0,o,s)),f=0,l=s>0?o-4:o;for(n=0;n<l;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[f++]=t>>16&255,c[f++]=t>>8&255,c[f++]=255&t;2===s&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[f++]=255&t);1===s&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[f++]=t>>8&255,c[f++]=255&t);return c},t.fromByteArray=function(e){for(var t,r=e.length,a=r%3,i=[],o=16383,u=0,c=r-a;u<c;u+=o)i.push(s(e,u,u+o>c?c:u+o));1===a?(t=e[r-1],i.push(n[t>>2]+n[t<<4&63]+"==")):2===a&&(t=(e[r-2]<<8)+e[r-1],i.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return i.join("")};for(var n=[],r=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0;o<64;++o)n[o]=i[o],r[i.charCodeAt(o)]=o;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function s(e,t,r){for(var a,i,o=[],u=t;u<r;u+=3)a=(e[u]<<16&16711680)+(e[u+1]<<8&65280)+(255&e[u+2]),o.push(n[(i=a)>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},58955:(e,t,n)=>{"use strict";var r=n(3506),a=n(75597),i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.lW=s,t.h2=50;var o=2147483647;function u(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,s.prototype),t}function s(e,t,n){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return l(e)}return c(e,t,n)}function c(e,t,n){if("string"==typeof e)return function(e,t){"string"==typeof t&&""!==t||(t="utf8");if(!s.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|g(e,t),r=u(n),a=r.write(e,t);a!==n&&(r=r.slice(0,a));return r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(G(e,Uint8Array)){var t=new Uint8Array(e);return h(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(G(e,ArrayBuffer)||e&&G(e.buffer,ArrayBuffer))return h(e,t,n);if("undefined"!=typeof SharedArrayBuffer&&(G(e,SharedArrayBuffer)||e&&G(e.buffer,SharedArrayBuffer)))return h(e,t,n);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return s.from(r,t,n);var a=function(e){if(s.isBuffer(e)){var t=0|p(e.length),n=u(t);return 0===n.length||e.copy(n,0,0,t),n}if(void 0!==e.length)return"number"!=typeof e.length||j(e.length)?u(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(a)return a;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return s.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function f(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function l(e){return f(e),u(e<0?0:0|p(e))}function d(e){for(var t=e.length<0?0:0|p(e.length),n=u(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function h(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,s.prototype),r}function p(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function g(e,t){if(s.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||G(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var a=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return q(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return L(e).length;default:if(a)return r?-1:q(e).length;t=(""+t).toLowerCase(),a=!0}}function m(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,t,n);case"utf8":case"utf-8":return O(this,t,n);case"ascii":return E(this,t,n);case"latin1":case"binary":return R(this,t,n);case"base64":return D(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function y(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function v(e,t,n,r,a){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),j(n=+n)&&(n=a?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(a)return-1;n=e.length-1}else if(n<0){if(!a)return-1;n=0}if("string"==typeof t&&(t=s.from(t,r)),s.isBuffer(t))return 0===t.length?-1:S(e,t,n,r,a);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):S(e,[t],n,r,a);throw new TypeError("val must be string, number or Buffer")}function S(e,t,n,r,a){var i,o=1,u=e.length,s=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,u/=2,s/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(a){var f=-1;for(i=n;i<u;i++)if(c(e,i)===c(t,-1===f?0:i-f)){if(-1===f&&(f=i),i-f+1===s)return f*o}else-1!==f&&(i-=i-f),f=-1}else for(n+s>u&&(n=u-s),i=n;i>=0;i--){for(var l=!0,d=0;d<s;d++)if(c(e,i+d)!==c(t,d)){l=!1;break}if(l)return i}return-1}function I(e,t,n,r){n=Number(n)||0;var a=e.length-n;r?(r=Number(r))>a&&(r=a):r=a;var i=t.length;r>i/2&&(r=i/2);for(var o=0;o<r;++o){var u=parseInt(t.substr(2*o,2),16);if(j(u))return o;e[n+o]=u}return o}function T(e,t,n,r){return V(q(t,e.length-n),e,n,r)}function w(e,t,n,r){return V(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function b(e,t,n,r){return V(L(t),e,n,r)}function C(e,t,n,r){return V(function(e,t){for(var n,r,a,i=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(n=e.charCodeAt(o))>>8,a=n%256,i.push(a),i.push(r);return i}(t,e.length-n),e,n,r)}function D(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function O(e,t,n){n=Math.min(e.length,n);for(var r=[],a=t;a<n;){var i,o,u,s,c=e[a],f=null,l=c>239?4:c>223?3:c>191?2:1;if(a+l<=n)switch(l){case 1:c<128&&(f=c);break;case 2:128==(192&(i=e[a+1]))&&(s=(31&c)<<6|63&i)>127&&(f=s);break;case 3:i=e[a+1],o=e[a+2],128==(192&i)&&128==(192&o)&&(s=(15&c)<<12|(63&i)<<6|63&o)>2047&&(s<55296||s>57343)&&(f=s);break;case 4:i=e[a+1],o=e[a+2],u=e[a+3],128==(192&i)&&128==(192&o)&&128==(192&u)&&(s=(15&c)<<18|(63&i)<<12|(63&o)<<6|63&u)>65535&&s<1114112&&(f=s)}null===f?(f=65533,l=1):f>65535&&(f-=65536,r.push(f>>>10&1023|55296),f=56320|1023&f),r.push(f),a+=l}return function(e){var t=e.length;if(t<=x)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=x));return n}(r)}s.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),s.poolSize=8192,s.from=function(e,t,n){return c(e,t,n)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array),s.alloc=function(e,t,n){return function(e,t,n){return f(e),e<=0?u(e):void 0!==t?"string"==typeof n?u(e).fill(t,n):u(e).fill(t):u(e)}(e,t,n)},s.allocUnsafe=function(e){return l(e)},s.allocUnsafeSlow=function(e){return l(e)},s.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==s.prototype},s.compare=function(e,t){if(G(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),G(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(e)||!s.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,a=0,i=Math.min(n,r);a<i;++a)if(e[a]!==t[a]){n=e[a],r=t[a];break}return n<r?-1:r<n?1:0},s.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return s.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=s.allocUnsafe(t),a=0;for(n=0;n<e.length;++n){var i=e[n];if(G(i,Uint8Array))a+i.length>r.length?s.from(i).copy(r,a):Uint8Array.prototype.set.call(r,i,a);else{if(!s.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(r,a)}a+=i.length}return r},s.byteLength=g,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)y(this,t,t+1);return this},s.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},s.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},s.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?O(this,0,e):m.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(e){if(!s.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===s.compare(this,e)},s.prototype.inspect=function(){var e="",n=t.h2;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},i&&(s.prototype[i]=s.prototype.inspect),s.prototype.compare=function(e,t,n,r,a){if(G(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===a&&(a=this.length),t<0||n>e.length||r<0||a>this.length)throw new RangeError("out of range index");if(r>=a&&t>=n)return 0;if(r>=a)return-1;if(t>=n)return 1;if(this===e)return 0;for(var i=(a>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),u=Math.min(i,o),c=this.slice(r,a),f=e.slice(t,n),l=0;l<u;++l)if(c[l]!==f[l]){i=c[l],o=f[l];break}return i<o?-1:o<i?1:0},s.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},s.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},s.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},s.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var a=this.length-t;if((void 0===n||n>a)&&(n=a),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return I(this,e,t,n);case"utf8":case"utf-8":return T(this,e,t,n);case"ascii":case"latin1":case"binary":return w(this,e,t,n);case"base64":return b(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var x=4096;function E(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(127&e[a]);return r}function R(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(e[a]);return r}function A(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var a="",i=t;i<n;++i)a+=F[e[i]];return a}function M(e,t,n){for(var r=e.slice(t,n),a="",i=0;i<r.length-1;i+=2)a+=String.fromCharCode(r[i]+256*r[i+1]);return a}function P(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function N(e,t,n,r,a,i){if(!s.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function U(e,t,n,r,a,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function B(e,t,n,r,i){return t=+t,n>>>=0,i||U(e,0,n,4),a.write(e,t,n,r,23,4),n+4}function _(e,t,n,r,i){return t=+t,n>>>=0,i||U(e,0,n,8),a.write(e,t,n,r,52,8),n+8}s.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,s.prototype),r},s.prototype.readUintLE=s.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);for(var r=this[e],a=1,i=0;++i<t&&(a*=256);)r+=this[e+i]*a;return r},s.prototype.readUintBE=s.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);for(var r=this[e+--t],a=1;t>0&&(a*=256);)r+=this[e+--t]*a;return r},s.prototype.readUint8=s.prototype.readUInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),this[e]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]|this[e+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(e,t){return e>>>=0,t||P(e,2,this.length),this[e]<<8|this[e+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},s.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);for(var r=this[e],a=1,i=0;++i<t&&(a*=256);)r+=this[e+i]*a;return r>=(a*=128)&&(r-=Math.pow(2,8*t)),r},s.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||P(e,t,this.length);for(var r=t,a=1,i=this[e+--r];r>0&&(a*=256);)i+=this[e+--r]*a;return i>=(a*=128)&&(i-=Math.pow(2,8*t)),i},s.prototype.readInt8=function(e,t){return e>>>=0,t||P(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},s.prototype.readInt16LE=function(e,t){e>>>=0,t||P(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt16BE=function(e,t){e>>>=0,t||P(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt32LE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},s.prototype.readInt32BE=function(e,t){return e>>>=0,t||P(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},s.prototype.readFloatLE=function(e,t){return e>>>=0,t||P(e,4,this.length),a.read(this,e,!0,23,4)},s.prototype.readFloatBE=function(e,t){return e>>>=0,t||P(e,4,this.length),a.read(this,e,!1,23,4)},s.prototype.readDoubleLE=function(e,t){return e>>>=0,t||P(e,8,this.length),a.read(this,e,!0,52,8)},s.prototype.readDoubleBE=function(e,t){return e>>>=0,t||P(e,8,this.length),a.read(this,e,!1,52,8)},s.prototype.writeUintLE=s.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t>>>=0,n>>>=0,r)||N(this,e,t,n,Math.pow(2,8*n)-1,0);var a=1,i=0;for(this[t]=255&e;++i<n&&(a*=256);)this[t+i]=e/a&255;return t+n},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t>>>=0,n>>>=0,r)||N(this,e,t,n,Math.pow(2,8*n)-1,0);var a=n-1,i=1;for(this[t+a]=255&e;--a>=0&&(i*=256);)this[t+a]=e/i&255;return t+n},s.prototype.writeUint8=s.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,1,255,0),this[t]=255&e,t+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var a=Math.pow(2,8*n-1);N(this,e,t,n,a-1,-a)}var i=0,o=1,u=0;for(this[t]=255&e;++i<n&&(o*=256);)e<0&&0===u&&0!==this[t+i-1]&&(u=1),this[t+i]=(e/o>>0)-u&255;return t+n},s.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var a=Math.pow(2,8*n-1);N(this,e,t,n,a-1,-a)}var i=n-1,o=1,u=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===u&&0!==this[t+i+1]&&(u=1),this[t+i]=(e/o>>0)-u&255;return t+n},s.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},s.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},s.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},s.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},s.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},s.prototype.writeFloatLE=function(e,t,n){return B(this,e,t,!0,n)},s.prototype.writeFloatBE=function(e,t,n){return B(this,e,t,!1,n)},s.prototype.writeDoubleLE=function(e,t,n){return _(this,e,t,!0,n)},s.prototype.writeDoubleBE=function(e,t,n){return _(this,e,t,!1,n)},s.prototype.copy=function(e,t,n,r){if(!s.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var a=r-n;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),a},s.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!s.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){var a=e.charCodeAt(0);("utf8"===r&&a<128||"latin1"===r)&&(e=a)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var o=s.isBuffer(e)?e:s.from(e,r),u=o.length;if(0===u)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=o[i%u]}return this};var k=/[^+/0-9A-Za-z-_]/g;function q(e,t){var n;t=t||1/0;for(var r=e.length,a=null,i=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!a){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&i.push(239,191,189);continue}a=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),a=n;continue}n=65536+(a-55296<<10|n-56320)}else a&&(t-=3)>-1&&i.push(239,191,189);if(a=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function L(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(k,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function V(e,t,n,r){for(var a=0;a<r&&!(a+n>=t.length||a>=e.length);++a)t[a+n]=e[a];return a}function G(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function j(e){return e!=e}var F=function(){for(var e="0123456789abcdef",t=new Array(256),n=0;n<16;++n)for(var r=16*n,a=0;a<16;++a)t[r+a]=e[n]+e[a];return t}()},75597:(e,t)=>{t.read=function(e,t,n,r,a){var i,o,u=8*a-r-1,s=(1<<u)-1,c=s>>1,f=-7,l=n?a-1:0,d=n?-1:1,h=e[t+l];for(l+=d,i=h&(1<<-f)-1,h>>=-f,f+=u;f>0;i=256*i+e[t+l],l+=d,f-=8);for(o=i&(1<<-f)-1,i>>=-f,f+=r;f>0;o=256*o+e[t+l],l+=d,f-=8);if(0===i)i=1-c;else{if(i===s)return o?NaN:1/0*(h?-1:1);o+=Math.pow(2,r),i-=c}return(h?-1:1)*o*Math.pow(2,i-r)},t.write=function(e,t,n,r,a,i){var o,u,s,c=8*i-a-1,f=(1<<c)-1,l=f>>1,d=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:i-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(u=isNaN(t)?1:0,o=f):(o=Math.floor(Math.log(t)/Math.LN2),t*(s=Math.pow(2,-o))<1&&(o--,s*=2),(t+=o+l>=1?d/s:d*Math.pow(2,1-l))*s>=2&&(o++,s/=2),o+l>=f?(u=0,o=f):o+l>=1?(u=(t*s-1)*Math.pow(2,a),o+=l):(u=t*Math.pow(2,l-1)*Math.pow(2,a),o=0));a>=8;e[n+h]=255&u,h+=p,u/=256,a-=8);for(o=o<<a|u,c+=a;c>0;e[n+h]=255&o,h+=p,o/=256,c-=8);e[n+h-p]|=128*g}},27318:e=>{"use strict";e.exports=function(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=n;return t}},8516:e=>{e.exports=function(e){return null!=e&&null!=e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}},87513:(e,t,n)=>{var r=n(27318),a=n(8516),i="undefined"!=typeof Float64Array;function o(e,t){return e[0]-t[0]}function u(){var e,t=this.stride,n=new Array(t.length);for(e=0;e<n.length;++e)n[e]=[Math.abs(t[e]),e];n.sort(o);var r=new Array(n.length);for(e=0;e<r.length;++e)r[e]=n[e][1];return r}function s(e,t){var n=["View",t,"d",e].join("");t<0&&(n="View_Nil"+e);var a="generic"===e;if(-1===t){var i="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(i)()}if(0===t){i="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(a?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(a?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}";return new Function("TrivialArray",i)(c[e][0])}i=["'use strict'"];var o=r(t),s=o.map((function(e){return"i"+e})),f="this.offset+"+o.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),l=o.map((function(e){return"b"+e})).join(","),d=o.map((function(e){return"c"+e})).join(",");i.push("function "+n+"(a,"+l+","+d+",d){this.data=a","this.shape=["+l+"]","this.stride=["+d+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),i.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){return "+o.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===t?i.push("proto.order=[0]"):(i.push("Object.defineProperty(proto,'order',{get:"),t<4?(i.push("function "+n+"_order(){"),2===t?i.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&i.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):i.push("ORDER})")),i.push("proto.set=function "+n+"_set("+s.join(",")+",v){"),a?i.push("return this.data.set("+f+",v)}"):i.push("return this.data["+f+"]=v}"),i.push("proto.get=function "+n+"_get("+s.join(",")+"){"),a?i.push("return this.data.get("+f+")}"):i.push("return this.data["+f+"]}"),i.push("proto.index=function "+n+"_index(",s.join(),"){return "+f+"}"),i.push("proto.hi=function "+n+"_hi("+s.join(",")+"){return new "+n+"(this.data,"+o.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+o.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var h=o.map((function(e){return"a"+e+"=this.shape["+e+"]"})),p=o.map((function(e){return"c"+e+"=this.stride["+e+"]"}));i.push("proto.lo=function "+n+"_lo("+s.join(",")+"){var b=this.offset,d=0,"+h.join(",")+","+p.join(","));for(var g=0;g<t;++g)i.push("if(typeof i"+g+"==='number'&&i"+g+">=0){d=i"+g+"|0;b+=c"+g+"*d;a"+g+"-=d}");i.push("return new "+n+"(this.data,"+o.map((function(e){return"a"+e})).join(",")+","+o.map((function(e){return"c"+e})).join(",")+",b)}"),i.push("proto.step=function "+n+"_step("+s.join(",")+"){var "+o.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+o.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(g=0;g<t;++g)i.push("if(typeof i"+g+"==='number'){d=i"+g+"|0;if(d<0){c+=b"+g+"*(a"+g+"-1);a"+g+"=ceil(-a"+g+"/d)}else{a"+g+"=ceil(a"+g+"/d)}b"+g+"*=d}");i.push("return new "+n+"(this.data,"+o.map((function(e){return"a"+e})).join(",")+","+o.map((function(e){return"b"+e})).join(",")+",c)}");var m=new Array(t),y=new Array(t);for(g=0;g<t;++g)m[g]="a[i"+g+"]",y[g]="b[i"+g+"]";i.push("proto.transpose=function "+n+"_transpose("+s+"){"+s.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+m.join(",")+","+y.join(",")+",this.offset)}"),i.push("proto.pick=function "+n+"_pick("+s+"){var a=[],b=[],c=this.offset");for(g=0;g<t;++g)i.push("if(typeof i"+g+"==='number'&&i"+g+">=0){c=(c+this.stride["+g+"]*i"+g+")|0}else{a.push(this.shape["+g+"]);b.push(this.stride["+g+"])}");return i.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),i.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+o.map((function(e){return"shape["+e+"]"})).join(",")+","+o.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",i.join("\n"))(c[e],u)}var c={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};e.exports=function(e,t,n,r){if(void 0===e)return(0,c.array[0])([]);"number"==typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var o=t.length;if(void 0===n){n=new Array(o);for(var u=o-1,f=1;u>=0;--u)n[u]=f,f*=t[u]}if(void 0===r){r=0;for(u=0;u<o;++u)n[u]<0&&(r-=(t[u]-1)*n[u])}for(var l=function(e){if(a(e))return"buffer";if(i)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),d=c[l];d.length<=o+1;)d.push(s(l,d.length-1));return(0,d[o+1])(e,t,n,r)}}}]);
//# sourceMappingURL=202.bundle.d39e81d8dcab067d033c.js.map