"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[471],{56471:(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var r=n(43001),a=n(3827),s=n.n(a),o=n(61529),i=n(60082),l=n(50995);const c={NO_NEVER:-1,CANCEL:0,HYDRATE_SEG:5};const u=function(e){let{servicesManager:t,rtDisplaySet:n,viewportIndex:r,toolGroupId:a="default",preHydrateCallbacks:s}=e;const{uiViewportDialogService:o}=t.services;return new Promise((async function(e,u){const p=await function(e,t){return new Promise((function(n,r){const a="Do you want to open this Segmentation?",s=[{type:i.LZ.U.secondary,text:"No",value:c.CANCEL},{type:i.LZ.U.primary,text:"Yes",value:c.HYDRATE_SEG}],o=t=>{e.hide(),n(t)};e.show({viewportIndex:t,type:"info",message:a,actions:s,onSubmit:o,onOutsideClick:()=>{e.hide(),n(c.CANCEL)}})}))}(o,r);if(p===c.HYDRATE_SEG){s?.forEach((e=>{e()}));e(await(0,l.Z)({rtDisplaySet:n,viewportIndex:r,toolGroupId:a,servicesManager:t}))}}))};var p=n(69190);const d=function(e,t,n){const{tools:r}=t.get("cornerstone.overlayViewportTools")??{};return e.createToolGroupAndAddTools(n,r,{})};function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},m.apply(this,arguments)}const{formatDate:S}=o.utils;function g(e){const{children:t,displaySets:n,viewportOptions:a,viewportIndex:s,viewportLabel:c,servicesManager:g,extensionManager:v,commandsManager:f}=e,{displaySetService:E,toolGroupService:y,segmentationService:w,uiNotificationService:b,customizationService:I}=g.services,D=`RTToolGroup-${s}`;if(n.length>1)throw new Error("RT viewport should only have a single display set");const h=n[0],[T,N]=(0,i.O_)(),[x,C]=(0,r.useState)(!1),[k,P]=(0,r.useState)(1),[O,M]=(0,r.useState)(h.isHydrated),[A,R]=(0,r.useState)(!h.isLoaded),[G,U]=(0,r.useState)(null),[L,_]=(0,r.useState)({percentComplete:null,totalSegments:null}),V=(0,r.useRef)(null),{viewports:H,activeViewportIndex:j}=T,F=h.getReferenceDisplaySet(),Y=function(e){const t=e.images[0],n={PatientID:t.PatientID,PatientName:t.PatientName,PatientSex:t.PatientSex,PatientAge:t.PatientAge,SliceThickness:t.SliceThickness,StudyDate:t.StudyDate,SeriesDescription:t.SeriesDescription,SeriesInstanceUID:t.SeriesInstanceUID,SeriesNumber:t.SeriesNumber,ManufacturerModelName:t.ManufacturerModelName,SpacingBetweenSlices:t.SpacingBetweenSlices};return n}(F);V.current={displaySet:F,metadata:Y};const $=e=>{U(e.detail.element)},Z=()=>{U(null)},B=(0,r.useCallback)((()=>{T?.viewports.forEach((e=>{let{viewportIndex:t}=e;f.runCommand("storePresentation",{viewportIndex:t})}))}),[T]),J=(0,r.useCallback)((()=>{const{component:t}=v.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone"),{displaySet:n}=V.current;return r.createElement(t,m({},e,{displaySets:[n,h],viewportOptions:{viewportType:"volume",toolGroupId:D,orientation:a.orientation,viewportId:a.viewportId},onElementEnabled:$,onElementDisabled:Z}))}),[s,h,D]),q=(0,r.useCallback)((e=>{e="left"===e?-1:1;const t=h.displaySetInstanceUID,n=w.getSegmentation(t),{segments:r}=n,a=Object.keys(r).length;let s=k+e;s>=a-1?s=1:0===s&&(s=a-1),w.jumpToSegmentCenter(t,s,D),P(s)}),[k]);(0,r.useEffect)((()=>{A||u({servicesManager:g,viewportIndex:s,rtDisplaySet:h,preHydrateCallbacks:[B]}).then((e=>{e&&M(!0)}))}),[g,s,h,A]),(0,r.useEffect)((()=>{const{unsubscribe:e}=w.subscribe(w.EVENTS.SEGMENTATION_LOADING_COMPLETE,(e=>{e.rtDisplaySet.displaySetInstanceUID===h.displaySetInstanceUID&&R(!1),e.overlappingSegments&&b.show({title:"Overlapping Segments",message:"Overlapping segments detected which is not currently supported",type:"warning"})}));return()=>{e()}}),[h]),(0,r.useEffect)((()=>{const{unsubscribe:e}=w.subscribe(w.EVENTS.SEGMENT_LOADING_COMPLETE,(e=>{let{percentComplete:t,numSegments:n}=e;_({percentComplete:t,totalSegments:n})}));return()=>{e()}}),[h]),(0,r.useEffect)((()=>{const e=E.subscribe(E.EVENTS.DISPLAY_SETS_REMOVED,(e=>{let{displaySetInstanceUIDs:t}=e;const n=H[j];t.includes(n.displaySetInstanceUID)&&N.setDisplaySetsForViewport({viewportIndex:j,displaySetInstanceUIDs:[]})}));return()=>{e.unsubscribe()}}),[]),(0,r.useEffect)((()=>{let e=y.getToolGroup(D);if(!e)return e=d(y,I,D),C(!0),()=>{w.removeSegmentationRepresentationFromToolGroup(D),y.destroyToolGroup(D)}}),[]),(0,r.useEffect)((()=>(M(h.isHydrated),()=>{w.removeSegmentationRepresentationFromToolGroup(D),V.current=null})),[h]);let z=null;if(!V.current||F.displaySetInstanceUID!==V.current.displaySet.displaySetInstanceUID)return null;t&&t.length&&(z=t.map(((e,t)=>e&&r.cloneElement(e,{viewportIndex:s,key:t}))));const{PatientID:K,PatientName:Q,PatientSex:W,PatientAge:X,SliceThickness:ee,ManufacturerModelName:te,StudyDate:ne,SeriesDescription:re,SpacingBetweenSlices:ae,SeriesNumber:se}=V.current.metadata,oe=async()=>{B();const e=await(0,l.Z)({rtDisplaySet:h,viewportIndex:s,servicesManager:g});M(e)};return r.createElement(r.Fragment,null,r.createElement(i.uY,{onDoubleClick:e=>{e.stopPropagation(),e.preventDefault()},onArrowsClick:q,getStatusComponent:()=>function(e){let{isHydrated:t,onStatusClick:n}=e,a=null,s=null;const{t:o}=(0,p.$G)("Common"),l=o("LOAD");switch(t){case!0:s=()=>r.createElement(i.JO,{name:"status-alert"}),a=()=>r.createElement("div",null,"This Segmentation is loaded in the segmentation panel");break;case!1:s=()=>r.createElement(i.JO,{name:"status-untracked"}),a=()=>r.createElement("div",null,"Click LOAD to load RTSTRUCT.")}const c=()=>r.createElement("div",{className:"flex h-6 leading-6 cursor-default text-sm text-white"},r.createElement("div",{className:"min-w-[45px] flex items-center p-1 rounded-l-xl rounded-r bg-customgray-100"},r.createElement(s,null),r.createElement("span",{className:"ml-1"},"RTSTRUCT")),!t&&r.createElement("div",{className:"ml-1 px-1.5 rounded cursor-pointer hover:text-black bg-primary-main hover:bg-primary-light",onMouseUp:n},l));return r.createElement(r.Fragment,null,a&&r.createElement(i.u,{content:r.createElement(a,null),position:"bottom-left"},r.createElement(c,null)),!a&&r.createElement(c,null))}({isHydrated:O,onStatusClick:oe}),studyData:{label:c,useAltStyling:!0,studyDate:S(ne),currentSeries:se,seriesDescription:`RT Viewport ${re}`,patientInformation:{patientName:Q?o.default.utils.formatPN(Q.Alphabetic):"",patientSex:W||"",patientAge:X||"",MRN:K||"",thickness:ee?`${ee.toFixed(2)}mm`:"",spacing:void 0!==ae?`${ae.toFixed(2)}mm`:"",scanner:te||""}}}),r.createElement("div",{className:"relative flex flex-row w-full h-full overflow-hidden"},A&&r.createElement(i.bk,{className:"w-full h-full",totalNumbers:L.totalSegments,percentComplete:L.percentComplete,loadingText:"Loading RTSTRUCT..."}),J(),z))}g.propTypes={displaySets:s().arrayOf(s().object),viewportIndex:s().number.isRequired,dataSource:s().object,children:s().node,customProps:s().object},g.defaultProps={customProps:{}};const v=g}}]);
//# sourceMappingURL=471.bundle.cdd9c1b7040c9a92d31c.js.map