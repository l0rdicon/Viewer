"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[451],{4451:(e,t,n)=>{n.r(t),n.d(t,{default:()=>E});var s=n(3827),a=n.n(s),r=n(43001),i=n(69190),o=n(61529),l=n(60082);const c=function(e,t,n){const{tools:s}=t.get("cornerstone.overlayViewportTools")??{};return e.createToolGroupAndAddTools(n,s,{})};var u=n(28417);const p={NO_NEVER:-1,CANCEL:0,HYDRATE_SEG:5};const m=function(e){let{servicesManager:t,segDisplaySet:n,viewportIndex:s,preHydrateCallbacks:a}=e;const{uiViewportDialogService:r}=t.services;return new Promise((async function(e,i){const o=await function(e,t){return new Promise((function(n,s){const a="Do you want to open this Segmentation?",r=[{type:l.LZ.U.secondary,text:"No",value:p.CANCEL},{type:l.LZ.U.primary,text:"Yes",value:p.HYDRATE_SEG}],i=t=>{e.hide(),n(t)};e.show({viewportIndex:t,type:"info",message:a,actions:r,onSubmit:i,onOutsideClick:()=>{e.hide(),n(p.CANCEL)}})}))}(r,s);if(o===p.HYDRATE_SEG){a?.forEach((e=>{e()}));e(await(0,u.Z)({segDisplaySet:n,viewportIndex:s,servicesManager:t}))}}))};function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},d.apply(this,arguments)}const{formatDate:S}=o.utils;function g(e){const{children:t,displaySets:n,viewportOptions:s,viewportIndex:a,viewportLabel:p,servicesManager:g,extensionManager:E,commandsManager:v}=e,{t:f}=(0,i.$G)("SEGViewport"),{displaySetService:y,toolGroupService:w,segmentationService:b,uiNotificationService:h,customizationService:D}=g.services,I=`SEGToolGroup-${a}`;if(n.length>1)throw new Error("SEG viewport should only have a single display set");const N=n[0],[x,C]=(0,l.O_)(),[T,k]=(0,r.useState)(1),[P,G]=(0,r.useState)(N.isHydrated),[M,O]=(0,r.useState)(!N.isLoaded),[A,L]=(0,r.useState)(null),[U,R]=(0,r.useState)({percentComplete:null,totalSegments:null}),V=(0,r.useRef)(null),{viewports:_,activeViewportIndex:H}=x,j=N.getReferenceDisplaySet(),F=function(e,t){const{SharedFunctionalGroupsSequence:[n]}=t.instance,{PixelMeasuresSequence:[s]}=n,{SpacingBetweenSlices:a,SliceThickness:r}=s,i=e.images[0],o={PatientID:i.PatientID,PatientName:i.PatientName,PatientSex:i.PatientSex,PatientAge:i.PatientAge,SliceThickness:i.SliceThickness||r,StudyDate:i.StudyDate,SeriesDescription:i.SeriesDescription,SeriesInstanceUID:i.SeriesInstanceUID,SeriesNumber:i.SeriesNumber,ManufacturerModelName:i.ManufacturerModelName,SpacingBetweenSlices:i.SpacingBetweenSlices||a};return o}(j,N);V.current={displaySet:j,metadata:F};const Y=e=>{L(e.detail.element)},B=()=>{L(null)},Z=(0,r.useCallback)((()=>{x?.viewports.forEach((e=>{let{viewportIndex:t}=e;v.runCommand("storePresentation",{viewportIndex:t})}))}),[x]),$=(0,r.useCallback)((()=>{const{component:t}=E.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone"),{displaySet:n}=V.current;return r.createElement(t,d({},e,{displaySets:[n,N],viewportOptions:{viewportType:"volume",toolGroupId:I,orientation:s.orientation,viewportId:s.viewportId},onElementEnabled:Y,onElementDisabled:B}))}),[a,N,I]),q=(0,r.useCallback)((e=>{e="left"===e?-1:1;const t=N.displaySetInstanceUID,n=b.getSegmentation(t),{segments:s}=n,a=Object.keys(s).length;let r=T+e;r>a-1?r=1:0===r&&(r=a-1),b.jumpToSegmentCenter(t,r,I),k(r)}),[T]);(0,r.useEffect)((()=>{M||m({servicesManager:g,viewportIndex:a,segDisplaySet:N,preHydrateCallbacks:[Z]}).then((e=>{e&&G(!0)}))}),[g,a,N,M]),(0,r.useEffect)((()=>{const{unsubscribe:e}=b.subscribe(b.EVENTS.SEGMENTATION_LOADING_COMPLETE,(e=>{e.segDisplaySet.displaySetInstanceUID===N.displaySetInstanceUID&&O(!1),e.overlappingSegments&&h.show({title:"Overlapping Segments",message:"Overlapping segments detected which is not currently supported",type:"warning"})}));return()=>{e()}}),[N]),(0,r.useEffect)((()=>{const{unsubscribe:e}=b.subscribe(b.EVENTS.SEGMENT_LOADING_COMPLETE,(e=>{let{percentComplete:t,numSegments:n}=e;R({percentComplete:t,totalSegments:n})}));return()=>{e()}}),[N]),(0,r.useEffect)((()=>{const e=y.subscribe(y.EVENTS.DISPLAY_SETS_REMOVED,(e=>{let{displaySetInstanceUIDs:t}=e;const n=_[H];t.includes(n.displaySetInstanceUID)&&C.setDisplaySetsForViewport({viewportIndex:H,displaySetInstanceUIDs:[]})}));return()=>{e.unsubscribe()}}),[]),(0,r.useEffect)((()=>{let e=w.getToolGroup(I);if(!e)return e=c(w,D,I),()=>{b.removeSegmentationRepresentationFromToolGroup(I),w.destroyToolGroup(I)}}),[]),(0,r.useEffect)((()=>(G(N.isHydrated),()=>{b.removeSegmentationRepresentationFromToolGroup(I),V.current=null})),[N]);let J=null;if(!V.current||j.displaySetInstanceUID!==V.current.displaySet.displaySetInstanceUID)return null;t&&t.length&&(J=t.map(((e,t)=>e&&r.cloneElement(e,{viewportIndex:a,key:t}))));const{PatientID:z,PatientName:K,PatientSex:Q,PatientAge:W,SliceThickness:X,ManufacturerModelName:ee,StudyDate:te,SeriesDescription:ne,SpacingBetweenSlices:se}=V.current.metadata,ae=async()=>{Z();const e=await(0,u.Z)({segDisplaySet:N,viewportIndex:a,servicesManager:g});G(e)};return r.createElement(r.Fragment,null,r.createElement(l.uY,{onDoubleClick:e=>{e.stopPropagation(),e.preventDefault()},onArrowsClick:q,getStatusComponent:()=>function(e){let{isHydrated:t,onStatusClick:n}=e,s=null,a=null;const{t:o}=(0,i.$G)("Common"),c=o("LOAD");switch(t){case!0:a=()=>r.createElement(l.JO,{name:"status-alert"}),s=()=>r.createElement("div",null,"This Segmentation is loaded in the segmentation panel");break;case!1:a=()=>r.createElement(l.JO,{name:"status-untracked"}),s=()=>r.createElement("div",null,"Click LOAD to load segmentation.")}const u=()=>r.createElement("div",{className:"flex h-6 leading-6 cursor-default text-sm text-white"},r.createElement("div",{className:"min-w-[45px] flex items-center p-1 rounded-l-xl rounded-r bg-customgray-100"},r.createElement(a,null),r.createElement("span",{className:"ml-1"},"SEG")),!t&&r.createElement("div",{className:"ml-1 px-1.5 rounded cursor-pointer hover:text-black bg-primary-main hover:bg-primary-light",onMouseUp:n},c));return r.createElement(r.Fragment,null,s&&r.createElement(l.u,{content:r.createElement(s,null),position:"bottom-left"},r.createElement(u,null)),!s&&r.createElement(u,null))}({isHydrated:P,onStatusClick:ae}),studyData:{label:p,useAltStyling:!0,studyDate:S(te),seriesDescription:`SEG Viewport ${ne}`,patientInformation:{patientName:K?o.default.utils.formatPN(K.Alphabetic):"",patientSex:Q||"",patientAge:W||"",MRN:z||"",thickness:X?o.utils.roundNumber(X,2):"",thicknessUnits:void 0!==X?"mm":"",spacing:void 0!==se?o.utils.roundNumber(se,2):"",scanner:ee||""}}}),r.createElement("div",{className:"relative flex flex-row w-full h-full overflow-hidden"},M&&r.createElement(l.bk,{className:"w-full h-full",totalNumbers:U.totalSegments,percentComplete:U.percentComplete,loadingText:"Loading SEG..."}),$(),J))}g.propTypes={displaySets:a().arrayOf(a().object),viewportIndex:a().number.isRequired,dataSource:a().object,children:a().node,customProps:a().object},g.defaultProps={customProps:{}};const E=g}}]);
//# sourceMappingURL=451.bundle.9998c1962fe464535ef6.js.map